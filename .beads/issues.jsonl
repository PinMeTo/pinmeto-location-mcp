{"id":"pinmeto-location-mcp-035","title":"Preserve API response body in error mapping","description":"mapAxiosErrorToApiError() discards e.response?.data which contains specific validation errors, rate limit info, and correlation IDs. Should preserve API's error message when available.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T12:23:21.214533+01:00","updated_at":"2025-12-19T12:24:22.611455+01:00","closed_at":"2025-12-19T12:24:22.611455+01:00","close_reason":"Fixed in src/errors.ts - added extractApiErrorMessage() to preserve API response body and default case for unexpected HTTP status codes"}
{"id":"pinmeto-location-mcp-04e","title":"Add integration test for 429 rate limiting response","description":"The mapAxiosErrorToApiError() function correctly maps 429 to RATE_LIMITED, but there's no integration test verifying that when the PinMeTo API returns 429, the tool response properly indicates retryable: true.\n\n**What it would catch**: Ensuring the rate-limiting flow is properly communicated to AI clients so they can implement backoff.\n\nPR Review Reference: pr-test-analyzer agent identified this as Medium (5/10).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T13:44:55.588945+01:00","updated_at":"2025-12-19T13:44:55.588945+01:00"}
{"id":"pinmeto-location-mcp-174","title":"Add tool integration error tests","description":"Only search_locations has an error integration test. Need error tests for get_location (NOT_FOUND) and at least one insights tool. Location: tests/mcp_server.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:58.064787+01:00","updated_at":"2025-12-19T13:27:03.720922+01:00","closed_at":"2025-12-19T13:27:03.720922+01:00","close_reason":"Added get_location NOT_FOUND integration test; fixed LocationOutputSchema to allow error-only responses"}
{"id":"pinmeto-location-mcp-1j5","title":"Add outputSchema to all tools","description":"Missing output schema declarations. Add Zod output schemas to all tool registrations for better AI understanding and validation. Modern MCP best practice. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Output schemas defined for all 13 tools using Zod\n- [ ] Schemas match actual response structure\n- [ ] Tool registrations include outputSchema parameter\n- [ ] Tests added to validate output against schema\n- [ ] Tool descriptions mention output structure\n- [ ] CLAUDE.md updated with outputSchema examples\n- [ ] Manually tested with MCP Inspector (verify schema display)\n- [ ] No regressions in tool functionality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:08.508063+01:00","updated_at":"2025-12-18T16:54:29.482664+01:00","closed_at":"2025-12-18T16:54:29.482664+01:00","close_reason":"Implemented outputSchema for all 15 tools with structuredContent returns"}
{"id":"pinmeto-location-mcp-24a","title":"Add unit tests for mapAxiosErrorToApiError","description":"Core error mapping logic has no test coverage. Need tests for: all HTTP status codes (400-504), network errors, retryable flag values, and AuthError handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:23:22.937929+01:00","updated_at":"2025-12-19T13:08:41.917607+01:00","closed_at":"2025-12-19T13:08:41.917607+01:00","close_reason":"Added 24 unit tests for mapAxiosErrorToApiError covering all HTTP status codes, API message extraction, network errors, AuthError handling, and edge cases"}
{"id":"pinmeto-location-mcp-277","title":"Add cache TTL expiration test","description":"The isExpired() logic (5-minute TTL) is never tested. If comparison operator were reversed, cache would never expire. Fix: Add test using vi.useFakeTimers() to verify TTL behavior. File: tests/mcp_server.test.ts","status":"closed","priority":1,"issue_type":"task","assignee":"Marcus Olsson","created_at":"2025-12-18T22:29:00.127806+01:00","updated_at":"2025-12-18T22:31:55.393952+01:00","closed_at":"2025-12-18T22:31:55.393952+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-27l","title":"Add tool annotations (readOnlyHint)","description":"No readOnlyHint or other annotations. Add readOnlyHint: true to all tools since they're all read-only. Helps AI agents plan better. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] readOnlyHint: true added to all 13 tools\n- [ ] Tool annotations verified in tool registrations\n- [ ] Tests updated to verify annotations present\n- [ ] CLAUDE.md updated with annotation conventions\n- [ ] Manually tested with MCP Inspector (verify annotations visible)\n- [ ] No regressions in tool functionality","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T11:36:08.818779+01:00","updated_at":"2025-12-18T16:18:08.906888+01:00","closed_at":"2025-12-18T16:18:08.906888+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-27l","depends_on_id":"pinmeto-location-mcp-2bp","type":"blocks","created_at":"2025-12-18T15:39:28.338938+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-2bp","title":"PR #17 Review Fixes - Tool Annotations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T15:37:16.399934+01:00","updated_at":"2025-12-18T15:53:51.71008+01:00","closed_at":"2025-12-18T15:53:51.71008+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-6kn","type":"blocks","created_at":"2025-12-18T15:37:45.610474+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-afq","type":"blocks","created_at":"2025-12-18T15:37:45.724351+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-8a6","type":"blocks","created_at":"2025-12-18T15:37:45.837018+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-3jl","type":"blocks","created_at":"2025-12-18T15:37:45.948766+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-2eu","title":"Create workflow helper tools","description":"Users manually orchestrate multi-step workflows. Create analyze_location_performance tool combining multiple network insights in one call. File: src/tools/helpers/workflows.ts (new)","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-18T11:36:10.15086+01:00","updated_at":"2025-12-18T11:36:10.15086+01:00"}
{"id":"pinmeto-location-mcp-2pt","title":"Add response caching for frequently accessed data","description":"No caching of location data. Add simple TTL cache (5-10 minutes) for get_locations and get_location. Reduces API load and improves response time. File: src/mcp_server.ts","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-18T11:36:10.480664+01:00","updated_at":"2025-12-18T11:36:10.480664+01:00"}
{"id":"pinmeto-location-mcp-33c","title":"Standardize date format consistency across tools","description":"Inconsistent date formats: keywords use YYYY-MM while insights use YYYY-MM-DD. Standardize all tools to YYYY-MM-DD for consistency. Breaking change but improves UX. Files: src/tools/networks/google.ts (keywords tools)\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] All tools use YYYY-MM-DD format\n- [ ] Keywords tools updated from YYYY-MM to YYYY-MM-DD\n- [ ] Input schemas updated with consistent date format\n- [ ] Date parsing logic updated\n- [ ] Version bump documented (breaking change if needed)\n- [ ] Migration guide created if breaking change\n- [ ] Tests updated with new date format\n- [ ] Tests verify format consistency across tools\n- [ ] Tool descriptions updated with date format\n- [ ] CLAUDE.md updated with date format standard\n- [ ] Manually tested all date inputs with MCP Inspector\n- [ ] No regressions in date handling","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:24.729235+01:00","updated_at":"2025-12-18T13:02:21.95008+01:00"}
{"id":"pinmeto-location-mcp-36x","title":"Fix timezone handling in checkGoogleDataLag","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T21:35:10.5031+01:00","updated_at":"2025-12-21T21:38:57.581411+01:00","closed_at":"2025-12-21T21:38:57.581411+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-391","title":"Add resource context to tool-level error messages","description":"**CRITICAL**: When an AI agent makes multiple calls, error messages like 'Resource not found. Verify the store ID exists.' don't specify *which* store ID failed.\n\nLocation: src/helpers.ts:149-158 (formatErrorResponse)\n\nThe issue is that formatErrorResponse() returns only the error message without operation context. For MCP clients (AI agents), this makes debugging difficult when multiple similar operations are performed.\n\n**Fix**: Enhance error context at the tool level before calling formatErrorResponse():\n```typescript\n// In get_location tool (src/tools/locations/locations.ts):\nif (!result.ok) {\n  const contextualError = {\n    ...result.error,\n    message: \\`Failed to fetch location '${storeId}': ${result.error.message}\\`\n  };\n  return formatErrorResponse(contextualError);\n}\n```\n\nApply similar pattern to all tools that operate on specific resources.\n\nPR Review Reference: silent-failure-hunter agent identified this as CRITICAL severity.","status":"closed","priority":1,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-19T13:44:31.345611+01:00","updated_at":"2025-12-19T13:49:27.826894+01:00","closed_at":"2025-12-19T13:49:27.826894+01:00","close_reason":"Added context parameter to formatErrorResponse() and updated all 15 tool call sites to include resource identifiers (storeId, query, date range) in error messages"}
{"id":"pinmeto-location-mcp-3jl","title":"Fix annotation test to verify readOnlyHint","description":"Test 'should register all 15 tools with readOnlyHint annotations' only checks expect(server).toBeDefined() - doesn't actually verify annotations exist on tools.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T15:37:27.431911+01:00","updated_at":"2025-12-18T15:53:18.126117+01:00","closed_at":"2025-12-18T15:53:18.126117+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-3z8","title":"Add date validation in getPeriodLabel to prevent undefined labels","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T21:35:15.899563+01:00","updated_at":"2025-12-21T21:40:00.780135+01:00","closed_at":"2025-12-21T21:40:00.780135+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-3zf","title":"Create search_locations lightweight discovery tool","description":"Create lightweight search/discovery tool for finding locations by name, address, or ID patterns. Complements get_locations by providing fuzzy search without fetching full location data. Files: src/tools/locations/locations.ts, src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] search_locations tool implemented and registered\n- [ ] Input schema with search query and optional filters\n- [ ] Output schema defined (location ID, name, address summary)\n- [ ] Tool annotations added (readOnlyHint: true)\n- [ ] Pagination support (limit parameter)\n- [ ] Tests added for search functionality\n- [ ] Tests cover edge cases (empty results, special characters)\n- [ ] Tool description clear and actionable\n- [ ] CLAUDE.md updated with search examples\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in existing location tools","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:07.298439+01:00","updated_at":"2025-12-18T21:02:18.920246+01:00","closed_at":"2025-12-18T21:02:18.920246+01:00","close_reason":"Feature complete: search_locations tool with bug fix, comprehensive tests, and schema improvements","dependencies":[{"issue_id":"pinmeto-location-mcp-3zf","depends_on_id":"pinmeto-location-mcp-b6n","type":"blocks","created_at":"2025-12-18T20:59:22.854587+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-3zf","depends_on_id":"pinmeto-location-mcp-d77","type":"blocks","created_at":"2025-12-18T20:59:22.976994+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-41i","title":"Add format and ordering validation to DateRangeSchema","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T21:35:05.109176+01:00","updated_at":"2025-12-21T21:38:23.131757+01:00","closed_at":"2025-12-21T21:38:23.131757+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-43x","title":"Add specific error handling for authentication failures","description":"The _getAndStoreToken() method (src/mcp_server.ts:96-119) throws errors that bubble up to makePinMeToRequest's catch block, losing authentication-specific context.\n\nHidden errors that get swallowed:\n- HTTP 401 when credentials are invalid\n- HTTP 403 when OAuth app is disabled/revoked\n- HTTP 400 for malformed grant request\n- Network errors reaching the OAuth endpoint\n\nShould wrap token fetching errors with clear authentication context:\n```typescript\nif (axios.isAxiosError(e) \u0026\u0026 e.response?.status === 401) {\n  throw new Error('Authentication failed: Invalid PINMETO_APP_ID or PINMETO_APP_SECRET');\n}\n```\n\nDepends on pinmeto-location-mcp-5gt (structured errors) being completed first.\n\nPR Review Reference: silent-failure-hunter agent identified this as HIGH severity.","status":"closed","priority":1,"issue_type":"task","assignee":"Marcus Olsson","created_at":"2025-12-18T16:06:16.387076+01:00","updated_at":"2025-12-19T14:14:37.199408+01:00","closed_at":"2025-12-19T14:14:37.199408+01:00","close_reason":"Implemented in PR #23 - structured error handling with AuthError class, specific 401/403 handling, and actionable error messages","dependencies":[{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-5gt","type":"blocks","created_at":"2025-12-18T16:06:25.938486+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-035","type":"blocks","created_at":"2025-12-19T12:23:34.584682+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-d9i","type":"blocks","created_at":"2025-12-19T12:23:34.699867+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-65x","type":"blocks","created_at":"2025-12-19T12:23:34.810222+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-49b","type":"blocks","created_at":"2025-12-19T12:23:34.920013+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-u62","type":"blocks","created_at":"2025-12-19T12:23:35.031956+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-gh7","type":"blocks","created_at":"2025-12-19T12:23:35.141998+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-24a","type":"blocks","created_at":"2025-12-19T12:23:35.249741+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-5ee","type":"blocks","created_at":"2025-12-19T13:20:07.663302+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-ddb","type":"blocks","created_at":"2025-12-19T13:20:07.803929+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-6p3","type":"blocks","created_at":"2025-12-19T13:20:07.954553+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-maj","type":"blocks","created_at":"2025-12-19T13:20:08.100165+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-mao","type":"blocks","created_at":"2025-12-19T13:20:08.244348+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-mm2","type":"blocks","created_at":"2025-12-19T13:20:08.387092+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-174","type":"blocks","created_at":"2025-12-19T13:20:08.525817+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-usk","type":"blocks","created_at":"2025-12-19T13:20:08.662332+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-l6k","type":"blocks","created_at":"2025-12-19T13:20:08.800662+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-s64","type":"blocks","created_at":"2025-12-19T13:20:08.938529+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-t7t","type":"blocks","created_at":"2025-12-19T13:20:09.074257+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-4pd","type":"blocks","created_at":"2025-12-19T13:20:09.213712+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-391","type":"blocks","created_at":"2025-12-19T13:44:54.712622+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-d44","type":"blocks","created_at":"2025-12-19T13:56:39.492294+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-wjn","type":"blocks","created_at":"2025-12-19T13:56:39.62566+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-662","type":"blocks","created_at":"2025-12-19T13:56:39.770564+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-4jj","type":"blocks","created_at":"2025-12-19T13:56:39.916817+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-cox","type":"blocks","created_at":"2025-12-19T13:56:40.050947+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-58t","type":"blocks","created_at":"2025-12-19T13:56:40.185419+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-49b","title":"Propagate ApiError through LocationCache","description":"_fetchAllLocations() discards lastError from makePaginatedPinMeToRequest(). Should propagate the ApiError so get_locations can return structured error details.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T12:23:22.06221+01:00","updated_at":"2025-12-19T12:27:16.456807+01:00","closed_at":"2025-12-19T12:27:16.456807+01:00","close_reason":"Fixed: LocationCache now returns CacheResult with stale indicator, error, and staleAgeSeconds. get_locations uses formatErrorResponse() for consistent error handling."}
{"id":"pinmeto-location-mcp-4jj","title":"Include specific error in pagination warning message","description":"When pagination fails mid-way through fetching, the warning says 'Data may be incomplete' but doesn't include WHY (rate limit? network error?). Should include error.code and error.message in the warning.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T13:56:33.30941+01:00","updated_at":"2025-12-19T14:01:31.00842+01:00","closed_at":"2025-12-19T14:01:31.00842+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-4pd","title":"Document searchLocations cache bypass behavior","description":"searchLocations bypasses LocationCache while getLocations uses it. Inconsistent resilience behavior should be documented. Location: src/tools/locations/locations.ts:249","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:20:00.225466+01:00","updated_at":"2025-12-19T13:30:18.858761+01:00","closed_at":"2025-12-19T13:30:18.858761+01:00","close_reason":"Added documentation comment explaining why search bypasses cache"}
{"id":"pinmeto-location-mcp-58t","title":"Add Zod date format validation to insights tools","description":"Invalid dates like '2024-13-45' pass Zod validation and get a generic API 400 error. Add regex validation to from/to date parameters: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Date must be YYYY-MM-DD format')","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:56:33.932581+01:00","updated_at":"2025-12-19T14:01:31.026492+01:00","closed_at":"2025-12-19T14:01:31.026492+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-5ee","title":"Fix error info lost on partial pagination failure","description":"When pagination partially fails (pages 1-3 succeed, page 4 fails), error details are dropped. Should always include lastError when !allPagesFetched. Location: src/tools/locations/locations.ts:137-140","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T13:19:56.065686+01:00","updated_at":"2025-12-19T13:20:50.827449+01:00","closed_at":"2025-12-19T13:20:50.827449+01:00","close_reason":"Fixed: Now includes errorCode and retryable whenever error exists, not just on stale cache"}
{"id":"pinmeto-location-mcp-5el","title":"Add input validation for date ranges","description":"No validation that 'from' date \u003c 'to' date. Add Zod refinements to validate date ranges before API calls. Improves error messages and prevents invalid API requests. Files: All tools with date parameters in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Zod refinements added to all tools with date ranges\n- [ ] Validation ensures from \u003c to\n- [ ] Validation checks date format (YYYY-MM-DD)\n- [ ] Validation checks dates are not in future (if applicable)\n- [ ] Clear error messages for validation failures\n- [ ] Tests added for date validation logic\n- [ ] Tests cover edge cases (equal dates, reversed dates, invalid formats)\n- [ ] Tool descriptions mention date validation\n- [ ] CLAUDE.md updated with date validation examples\n- [ ] Manually tested invalid dates with MCP Inspector\n- [ ] No regressions in valid date handling","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:25.006254+01:00","updated_at":"2025-12-18T13:02:21.674932+01:00"}
{"id":"pinmeto-location-mcp-5gt","title":"Return structured errors instead of null from API requests","description":"The makePinMeToRequest method (src/mcp_server.ts:48-62) catches all exceptions with a broad 'catch (e: any)' and returns null, making it impossible to distinguish between:\n- HTTP 401 Unauthorized (expired/invalid token)\n- HTTP 403 Forbidden (insufficient permissions)\n- HTTP 404 Not Found (invalid storeId)\n- HTTP 400 Bad Request (malformed date format)\n- HTTP 429 Rate Limited\n- HTTP 500/503 Server Errors\n- Network timeout (ETIMEDOUT)\n- DNS resolution failure (ENOTFOUND)\n- Connection refused (ECONNREFUSED)\n- SSL certificate errors\n- Token fetch failure during _getPinMeToAccessToken()\n\nShould return structured error objects like:\n```typescript\n{ data?: any; error?: { code: string; message: string; statusCode?: number } }\n```\n\nThis is CRITICAL because with the new structuredContent.error field (from outputSchema PR), all 15 tools return the same generic 'Unable to fetch X data' message regardless of root cause. AI clients cannot provide actionable guidance.\n\nPR Review Reference: silent-failure-hunter agent identified this as CRITICAL severity.","status":"closed","priority":1,"issue_type":"task","assignee":"Marcus Olsson","created_at":"2025-12-18T16:06:16.106816+01:00","updated_at":"2025-12-19T14:15:36.138774+01:00","closed_at":"2025-12-19T14:15:36.138774+01:00","close_reason":"Implemented in PR #23 - ApiResult\u003cT\u003e discriminated union, mapAxiosErrorToApiError(), structured error codes with retryable flag"}
{"id":"pinmeto-location-mcp-5tq","title":"Fix race condition in cache population","description":"Multiple concurrent requests on expired cache trigger separate API fetches. For 5000+ locations this wastes bandwidth. Fix: Implement promise deduplication - cache the fetch promise itself. File: src/cache/location-cache.ts:39-46","status":"closed","priority":1,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.847919+01:00","updated_at":"2025-12-18T22:31:55.39354+01:00","closed_at":"2025-12-18T22:31:55.39354+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-65x","title":"Use formatErrorResponse in get_locations tool","description":"get_locations returns custom error shape missing errorCode and retryable fields. Should use formatErrorResponse() for consistent error structure across all tools.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T12:23:21.77716+01:00","updated_at":"2025-12-19T12:27:16.457348+01:00","closed_at":"2025-12-19T12:27:16.457348+01:00","close_reason":"Fixed: LocationCache now returns CacheResult with stale indicator, error, and staleAgeSeconds. get_locations uses formatErrorResponse() for consistent error handling."}
{"id":"pinmeto-location-mcp-662","title":"Set error field when returning stale cache data","description":"When returning stale data due to API failure in get_locations, the error field is not set. AI agents checking only for error presence may miss that data is stale. Should set error field to make staleness explicit.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T13:56:33.002634+01:00","updated_at":"2025-12-19T14:01:30.998855+01:00","closed_at":"2025-12-19T14:01:30.998855+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-6a5","title":"Fix empty results treated as errors in get_locations","description":"The get_locations tool (src/tools/locations/locations.ts:112-125) conflates 'API failed' with 'no locations exist'. An account with zero locations receives an error message when it should receive an empty array with no error.\n\n**Current behavior:**\n```typescript\nconst [data, areAllPagesFetched] = await server.makePaginatedPinMeToRequest(url);\nif (\\!data || data.length === 0) {\n  return {\n    content: [{ type: 'text', text: 'Unable to fetch location data.' }],\n    structuredContent: {\n      data: [],\n      allPagesFetched: false,\n      error: 'Unable to fetch location data.'\n    }\n  };\n}\n```\n\n**Expected behavior:**\n```typescript\n// Check if the API call itself failed (first page returned null)\nif (data === null) {\n  return {\n    content: [{ type: 'text', text: 'Unable to fetch location data from PinMeTo API.' }],\n    structuredContent: {\n      data: [],\n      allPagesFetched: false,\n      error: 'API request failed. Check credentials and connectivity.'\n    }\n  };\n}\n\n// Empty results are valid, not an error\nif (data.length === 0) {\n  return {\n    content: [{ type: 'text', text: 'No locations found for this account.' }],\n    structuredContent: { data: [], allPagesFetched: true }\n  };\n}\n```\n\n**User Impact:** AI clients cannot distinguish between 'this account has no locations' (valid state) and 'the API call failed' (error state).\n\nPR Review Reference: silent-failure-hunter agent identified this as HIGH severity.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:11:09.893077+01:00","updated_at":"2025-12-18T23:27:20.195906+01:00","closed_at":"2025-12-18T23:27:20.195906+01:00","close_reason":"Already fixed - code now distinguishes empty results (allPagesFetched=true) from API failures (allPagesFetched=false) in get_locations, search_locations, and LocationCache"}
{"id":"pinmeto-location-mcp-6h1","title":"Add Google Review Insights with MCP Sampling","description":"Implement pinmeto_get_google_review_insights tool that uses MCP Sampling to analyze reviews server-side and return summarized insights instead of raw data.\n\n## Key Features\n- AI-powered sentiment analysis via MCP Sampling\n- Large dataset handling with confirmation flow\n- Statistical fallback when sampling unavailable\n- PII sanitization before sampling\n- Caching for insights (1-hour TTL)\n\n## Completion Checklist\n- [ ] Implementation complete\n- [ ] Tests added and passing\n- [ ] Manual testing performed\n- [ ] README.md updated (if applicable)\n- [ ] Other documentation updated (if applicable)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T08:41:40.947139+01:00","updated_at":"2025-12-23T09:00:04.231688+01:00","closed_at":"2025-12-23T09:00:04.231688+01:00","close_reason":"Feature complete: implemented pinmeto_get_google_review_insights tool with MCP Sampling, statistical fallback, and comprehensive tests"}
{"id":"pinmeto-location-mcp-6h1.1","title":"Verify MCP SDK sampling support","description":"Check SDK version, review MCP spec, test basic sampling request","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:51.708975+01:00","updated_at":"2025-12-23T08:43:53.64777+01:00","closed_at":"2025-12-23T08:43:53.64777+01:00","close_reason":"Verified SDK v1.25.1 supports sampling via server.server.createMessage()","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.1","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:51.711624+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.2","title":"Add Zod schemas for review insights","description":"Add schemas to src/schemas/output.ts for insights response types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:52.028999+01:00","updated_at":"2025-12-23T08:44:56.307622+01:00","closed_at":"2025-12-23T08:44:56.307622+01:00","close_reason":"Added 15 Zod schemas for review insights including SamplingStrategy, AnalysisType, Sentiment, Severity, and full output schemas","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.2","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:52.029419+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.3","title":"Implement helpers and utilities","description":"Add PII sanitization, token estimation, sampling strategies to src/helpers.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:52.34129+01:00","updated_at":"2025-12-23T08:46:32.243575+01:00","closed_at":"2025-12-23T08:46:32.243575+01:00","close_reason":"Added PII sanitization, token estimation, stratified sampling, recent-weighted sampling, cache key builder, and statistical computation helpers","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.3","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:52.34169+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.4","title":"Implement MCP Sampling integration","description":"Create src/sampling/ directory with prompts, request builder, response parser, batching","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:52.665765+01:00","updated_at":"2025-12-23T08:48:57.494343+01:00","closed_at":"2025-12-23T08:48:57.494343+01:00","close_reason":"Created src/sampling/ module with prompts, request-builder, response-parser, and batching support","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.4","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:52.666175+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.5","title":"Implement statistical fallback","description":"Add basic statistical analysis for clients without sampling support","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:53.006805+01:00","updated_at":"2025-12-23T08:50:31.896555+01:00","closed_at":"2025-12-23T08:50:31.896555+01:00","close_reason":"Added performStatisticalAnalysis and performStatisticalLocationComparison functions to helpers.ts","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.5","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:53.007142+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.6","title":"Create markdown formatter","description":"Add src/formatters/review-insights.ts for markdown output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:53.33177+01:00","updated_at":"2025-12-23T08:52:06.747775+01:00","closed_at":"2025-12-23T08:52:06.747775+01:00","close_reason":"Created formatReviewInsightsAsMarkdown and formatLargeDatasetWarningAsMarkdown functions","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.6","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:53.33219+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.7","title":"Implement main tool","description":"Add getGoogleReviewInsights() to src/tools/networks/google.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:53.674789+01:00","updated_at":"2025-12-23T08:54:25.818299+01:00","closed_at":"2025-12-23T08:54:25.818299+01:00","close_reason":"Implemented getGoogleReviewInsights with MCP Sampling, large dataset handling, and statistical fallback","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.7","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:53.675196+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.8","title":"Register tool and add caching","description":"Register in mcp_server.ts, add insights cache with 1-hour TTL","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:54.003217+01:00","updated_at":"2025-12-23T08:55:01.260151+01:00","closed_at":"2025-12-23T08:55:01.260151+01:00","close_reason":"Registered getGoogleReviewInsights in mcp_server.ts","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.8","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:54.00363+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6h1.9","title":"Add tests","description":"Add sampling, review-insights, and PII sanitization tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T08:41:54.324305+01:00","updated_at":"2025-12-23T09:00:03.96286+01:00","closed_at":"2025-12-23T09:00:03.96286+01:00","close_reason":"Added comprehensive test coverage for review insights module","dependencies":[{"issue_id":"pinmeto-location-mcp-6h1.9","depends_on_id":"pinmeto-location-mcp-6h1","type":"parent-child","created_at":"2025-12-23T08:41:54.324683+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-6kn","title":"Fix CLAUDE.md env loading documentation","description":"CLAUDE.md states env vars are loaded via process.loadEnvFile() but this was removed. Update to reflect --env-file=.env.local approach in npm scripts.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T15:37:26.596608+01:00","updated_at":"2025-12-18T15:52:08.578352+01:00","closed_at":"2025-12-18T15:52:08.578352+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-6p3","title":"Add unit tests for formatErrorResponse helper","description":"formatErrorResponse is used by 16 tools but has no direct unit tests. Need to verify content array format, structuredContent fields (error, errorCode, retryable). Location: src/helpers.ts:144-157","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:19:56.706215+01:00","updated_at":"2025-12-19T13:23:24.205697+01:00","closed_at":"2025-12-19T13:23:24.205697+01:00","close_reason":"Added 4 unit tests for formatErrorResponse covering all error codes and field validation"}
{"id":"pinmeto-location-mcp-7ru","title":"Add comprehensive tool-level testing","description":"Current tests only cover core server. MCP requirement: 'Comprehensive testing should cover functional, integration, security, performance.' Add tool-level tests with mock API responses for all 15 tools. Files: tests/ directory\n\n**NEW from PR Review (outputSchema PR):**\nThe pr-test-analyzer found critical test gaps:\n1. No tests verify structuredContent.data is returned on successful tool calls\n2. No tests verify structuredContent.error is returned on API failures\n3. No tests verify response shapes match declared outputSchemas\n4. No tests for empty data scenarios (0 locations vs API failure)\n\nSuggested tests:\n```typescript\nit('should return structuredContent.data on successful get_location call', async () =\u003e {\n  // Mock a successful API response\n  // Invoke get_location tool\n  // Verify response includes structuredContent.data matching LocationOutputSchema\n});\n\nit('should return structuredContent.error when API returns null', async () =\u003e {\n  // Mock API to return null\n  // Invoke tool\n  // Verify response includes structuredContent.error\n});\n\nit('should return data conforming to InsightsOutputSchema', async () =\u003e {\n  const result = await invokeGoogleInsights();\n  expect(() =\u003e z.object(InsightsOutputSchema).parse(result.structuredContent)).not.toThrow();\n});\n```\n\nPR Review Reference: pr-test-analyzer agent rated test coverage gaps at 9/10 severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:25.28202+01:00","updated_at":"2025-12-18T17:10:35.397209+01:00"}
{"id":"pinmeto-location-mcp-84q","title":"Add date validation in aggregateMetrics and getPeriodKey","description":"The getPeriodKey function (src/helpers.ts:86-115) parses date strings without validation. Invalid dates silently produce NaN values that propagate through aggregation.\n\n**Current behavior:**\n```typescript\nfunction getPeriodKey(dateStr: string, period: AggregationPeriod): string {\n  const date = new Date(dateStr);  // No validation - could be Invalid Date\n  const year = date.getFullYear();  // Returns NaN for invalid dates\n  const month = date.getMonth();    // Returns NaN for invalid dates\n  ...\n}\n```\n\n**Problem:** If the API returns dates in an unexpected format, aggregation produces keys like 'NaN-NaN' or 'NaN-Q1' without any error indication.\n\n**Recommended fix:**\n```typescript\nfunction getPeriodKey(dateStr: string, period: AggregationPeriod): string {\n  const date = new Date(dateStr);\n  if (isNaN(date.getTime())) {\n    console.error(`Invalid date string for aggregation: \"${dateStr}\"`);\n    return dateStr; // Fall back to original key\n  }\n  ...\n}\n```\n\nAlso add defensive checks in aggregateMetrics():\n```typescript\nif (\\!insightData || typeof insightData.key \\!== 'string') {\n  console.error(`Invalid insight data at index ${index}: missing key`);\n  return { key: 'unknown', metrics: [] };\n}\n\nif (\\!Array.isArray(insightData.metrics)) {\n  console.error(`Invalid metrics for insight ${insightData.key}: not an array`);\n  return { key: insightData.key, metrics: [] };\n}\n```\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T17:11:21.045395+01:00","updated_at":"2025-12-18T17:11:21.045395+01:00"}
{"id":"pinmeto-location-mcp-8a6","title":"Add test for Initialize handler capabilities fix","description":"The bug fix returning serverInfo.capabilities instead of request.params.capabilities has no test coverage. Add test verifying server returns its own capabilities, not client's.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T15:37:27.146519+01:00","updated_at":"2025-12-18T15:53:18.127+01:00","closed_at":"2025-12-18T15:53:18.127+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-8et","title":"Add pagination/filtering to get_locations","description":"Add pagination support (limit, offset) and filtering capabilities to get_locations tool. Currently fetches all locations with hardcoded pagesize=1000. Files: src/tools/locations/locations.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Limit parameter added (default: 50, max: 1000)\n- [ ] Offset parameter added for pagination\n- [ ] Filter parameters added (status, type, etc.)\n- [ ] Response includes pagination metadata (has_more, total_count)\n- [ ] Output schema updated with pagination fields\n- [ ] Tests added for pagination logic\n- [ ] Tests cover edge cases (limit=0, large offsets)\n- [ ] Tool description updated with pagination examples\n- [ ] CLAUDE.md updated with pagination patterns\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in get_locations functionality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:07.006914+01:00","updated_at":"2025-12-18T22:39:38.504732+01:00","closed_at":"2025-12-18T22:39:38.504732+01:00","close_reason":"All subtasks completed. Pagination, filtering, caching implemented with fixes for cache error handling, race conditions, and incomplete data warnings.","dependencies":[{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-sde","type":"blocks","created_at":"2025-12-18T22:29:05.499204+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-m3g","type":"blocks","created_at":"2025-12-18T22:29:05.609909+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-5tq","type":"blocks","created_at":"2025-12-18T22:29:05.720183+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-277","type":"blocks","created_at":"2025-12-18T22:29:05.83056+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-jry","type":"blocks","created_at":"2025-12-18T22:29:05.94071+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-9wk","title":"Track pagination progress and report partial data context","description":"makePaginatedPinMeToRequest (src/mcp_server.ts:64-83) silently continues on partial failure, returning partial data with allPagesFetched=false but no context about how incomplete it is (10% vs 99%). Users may make decisions based on incomplete data without knowing the severity.\n\n**NEW from PR Review (outputSchema PR):**\nThe get_locations tool returns structuredContent without a warning when pagination fails:\n```typescript\nstructuredContent: { data, allPagesFetched: areAllPagesFetched }\n// ^ No warning field, even though pagination failed partway\n```\n\nRecommended fix:\n```typescript\nstructuredContent: { \n  data, \n  allPagesFetched: areAllPagesFetched,\n  ...(areAllPagesFetched ? {} : { warning: 'Pagination interrupted. Results may be incomplete.' })\n}\n```\n\nShould also track page numbers (e.g., 'Fetched 3 of unknown pages') and provide context about what was successfully fetched.\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T16:06:16.660636+01:00","updated_at":"2025-12-18T17:10:35.657627+01:00"}
{"id":"pinmeto-location-mcp-adi","title":"Migrate to structured content (type: json)","description":"**STATUS: Largely completed by outputSchema PR (feat/output-schema-all-tools)**\n\nOriginal goal was to migrate from type:'text' to type:'json'. However, the modern MCP pattern (per MCP builder skill) is actually:\n- Keep type:'text' in content array (for legacy clients)\n- ADD structuredContent field (for modern AI clients)\n\nThe outputSchema PR implements this pattern:\n```typescript\nreturn {\n  content: [{ type: 'text', text: JSON.stringify(data) }],\n  structuredContent: { data: aggregatedData }  // Modern pattern\n};\n```\n\n**What's done:**\n- All 15 tools return structuredContent alongside content\n- Output schemas defined in src/schemas/output.ts\n- Tests verify outputSchema is present on all tools\n\n**Remaining work (minor):**\n- Consider whether type:'text' with JSON.stringify is optimal or if type:'json' would be better for the content field\n- Verify MCP SDK version supports both patterns\n\nThis bead can likely be closed once the outputSchema PR is merged.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:09.147196+01:00","updated_at":"2025-12-21T18:53:49.095539+01:00","closed_at":"2025-12-21T18:53:49.095539+01:00","close_reason":"PR #27 merged - replaced z.unknown() with concrete Zod schemas"}
{"id":"pinmeto-location-mcp-afq","title":"Fix typo 'aggregration' in google.ts","description":"In get_all_google_insights tool description, 'no aggregration' should be 'no aggregation'","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T15:37:26.871023+01:00","updated_at":"2025-12-18T15:51:49.987231+01:00","closed_at":"2025-12-18T15:51:49.987231+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-agy","title":"Surface error context for partial search_locations failures","description":"When search_locations pagination partially fails (some pages fetched, then error), the error is silently lost and users receive incomplete results without warning.\n\n**Location**: src/tools/locations/locations.ts:254-268\n\n**Hidden Errors**:\n- Rate limiting on page 3 of 5\n- Network timeout on page 2 of 3\n- Server errors mid-pagination\n\n**User Impact**: Users receive incomplete search results without knowing the data is partial. They may make decisions based on incomplete data.\n\n**Fix**: Surface the error even when partial data is returned:\n```typescript\nreturn {\n  content: [{ type: 'text', text: resultText }],\n  structuredContent: { \n    data: results, \n    totalMatches, \n    hasMore,\n    // Add error context for partial failures\n    ...(lastError \u0026\u0026 !areAllPagesFetched ? {\n      warning: \\`Search results may be incomplete: ${lastError.message}\\`,\n      errorCode: lastError.code,\n      retryable: lastError.retryable\n    } : {})\n  }\n};\n```\n\nPR Review Reference: silent-failure-hunter agent identified this as HIGH severity.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-19T13:45:33.110498+01:00","updated_at":"2025-12-19T13:45:33.110498+01:00"}
{"id":"pinmeto-location-mcp-ap4","title":"Address PR review findings for Google Review Insights","description":"Fix all issues identified during the comprehensive PR review of the Google Review Insights feature (PR #32).\n\n## Review Summary\n- 4 Critical issues (error handling, test coverage)\n- 6 Important issues (type safety, validation)\n- 6 Suggestions (documentation, code quality)\n\n## Completion Checklist\n- [ ] All critical issues fixed\n- [ ] All important issues fixed\n- [ ] All suggestions addressed\n- [ ] Tests added and passing\n- [ ] Build compiles successfully","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-23T09:45:31.77545+01:00","updated_at":"2025-12-23T09:46:31.943956+01:00"}
{"id":"pinmeto-location-mcp-ap4.1","title":"Fix silent skip of failed store fetches","description":"When fetching reviews for multiple stores, failures are silently ignored. If ALL stores fail, users get 'No reviews found' instead of the actual error.\n\nFile: src/tools/networks/google.ts:1064-1076\n\nFix: Track failures and surface them when all stores fail.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T09:45:42.055226+01:00","updated_at":"2025-12-23T09:49:02.016835+01:00","closed_at":"2025-12-23T09:49:02.016835+01:00","close_reason":"Fixed in google.ts: added store failure tracking, error details in fallback, and warningCode priority logic","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.1","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:45:42.064226+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.10","title":"Add test for buildMergeRequest function","description":"The buildMergeRequest() function used by batch processing has no test coverage.\n\nFile: src/sampling/request-builder.ts:125-160","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T09:46:03.809882+01:00","updated_at":"2025-12-23T09:46:03.809882+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.10","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:03.810818+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.11","title":"Clarify calculatePriorPeriod JSDoc example","description":"The calculatePriorPeriod example could be clearer about the calculation logic.\n\nFile: src/helpers.ts:386-391","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:17.370913+01:00","updated_at":"2025-12-23T09:46:17.370913+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.11","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:17.376005+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.12","title":"Document magic numbers with rationale","description":"Constants lack rationale documentation:\n- TOKENS_PER_REVIEW=150\n- DEFAULT_BATCH_SIZE=300\n- MAX_BATCHES=20\n- temperature: 0.3/0.2\n- Recent-weighted sampling percentages 60/25/15\n\nFiles: helpers.ts, batching.ts, request-builder.ts","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:17.690042+01:00","updated_at":"2025-12-23T09:46:17.690042+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.12","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:17.691233+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.13","title":"Remove deprecated legacy functions","description":"aggregateMetrics and embedComparisonLegacy are marked deprecated. Consider removal instead of maintenance.\n\nFile: src/helpers.ts:74-75, 540-542","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:18.001381+01:00","updated_at":"2025-12-23T09:46:18.001381+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.13","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:18.002425+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.14","title":"Extract shared PeriodSummarySchema","description":"The inline period objects in ReviewInsightsTrendsSchema duplicate structure. Extract to a shared schema for DRY compliance.\n\nFile: src/schemas/output.ts","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:18.309611+01:00","updated_at":"2025-12-23T09:46:18.309611+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.14","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:18.311416+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.15","title":"Add cross-field refinements to schemas","description":"Add Zod refinements:\n- sentimentDistribution percentages should sum to 100\n- analyzedReviewCount \u003c= totalReviewCount\n\nFile: src/schemas/output.ts","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:18.632643+01:00","updated_at":"2025-12-23T09:46:18.632643+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.15","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:18.634278+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.16","title":"Fix date dependency in sampling tests","description":"Tests use hardcoded dates from January 2024, making weighted sampling tests fragile as time passes.\n\nFile: tests/review-insights.test.ts","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-23T09:46:18.977091+01:00","updated_at":"2025-12-23T09:57:24.071769+01:00","closed_at":"2025-12-23T09:57:24.071769+01:00","close_reason":"Fixed flaky test by using relative dates instead of hardcoded dates from 2024","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.16","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:18.979174+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.2","title":"Include error details in AI sampling fallback","description":"When AI sampling fails, the code falls back to statistical analysis with only console.error logging. Users receive degraded results without knowing why.\n\nFile: src/tools/networks/google.ts:1345-1354\n\nFix: Include error message in samplingNote for debugging.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T09:45:42.369327+01:00","updated_at":"2025-12-23T09:49:02.021399+01:00","closed_at":"2025-12-23T09:49:02.021399+01:00","close_reason":"Fixed in google.ts: added store failure tracking, error details in fallback, and warningCode priority logic","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.2","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:45:42.370467+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.3","title":"Add failure threshold for batch processing","description":"If 19 of 20 batches fail, users get analysis based on 5% of data with no clear indication. No failure threshold prevents degraded output.\n\nFile: src/sampling/batching.ts:76-91\n\nFix: Add failure rate threshold and abort if \u003e50% batches fail.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T09:45:48.939235+01:00","updated_at":"2025-12-23T09:49:36.416876+01:00","closed_at":"2025-12-23T09:49:36.416876+01:00","close_reason":"Added BATCH_FAILURE_THRESHOLD constant and fail-fast check in processInBatches loop","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.3","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:45:48.946873+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.4","title":"Add tests for batch processing module","description":"The entire batching.ts module (278 lines) has zero test coverage. This is critical because processInBatches() is called for datasets \u003e300 reviews.\n\nFile: src/sampling/batching.ts\n\nAdd tests for:\n- processInBatches() success, partial failure, all fail cases\n- manualMergeResults() rating distributions, themes, issues\n- buildMergeRequest() in request-builder.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T09:45:49.269221+01:00","updated_at":"2025-12-23T09:51:26.784648+01:00","closed_at":"2025-12-23T09:51:26.784648+01:00","close_reason":"Added comprehensive tests for processInBatches including failure threshold, error handling, and merge fallback","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.4","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:45:49.27168+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.5","title":"Document SDK server access pattern","description":"The code uses (server as any).server to access createMessage for MCP Sampling. This is fragile. Add documentation explaining this pattern and SDK version dependency.\n\nFile: src/tools/networks/google.ts:1293-1296","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T09:46:02.228846+01:00","updated_at":"2025-12-23T09:46:02.228846+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.5","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:02.235887+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.6","title":"Consolidate duplicate RawReview type definitions","description":"Two separate RawReview interfaces exist with inconsistent date field optionality. Use the exported type from helpers.ts.\n\nFiles: google.ts:175-184 and helpers.ts:764-774","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T09:46:02.54729+01:00","updated_at":"2025-12-23T09:54:23.015145+01:00","closed_at":"2025-12-23T09:54:23.015145+01:00","close_reason":"Consolidated RawReview type: now imported from helpers.ts, removed duplicate definition from google.ts, simplified sanitizeReviews call","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.6","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:02.548837+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.7","title":"Fix warningCode overwrite issue","description":"Two spread conditions can both set warningCode, with the second overwriting the first. Use a single conditional to determine the appropriate warning.\n\nFile: src/tools/networks/google.ts:1401-1402","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T09:46:02.860541+01:00","updated_at":"2025-12-23T09:49:02.02489+01:00","closed_at":"2025-12-23T09:49:02.02489+01:00","close_reason":"Fixed in google.ts: added store failure tracking, error details in fallback, and warningCode priority logic","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.7","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:02.862739+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.8","title":"Improve phone number regex precision","description":"The phone regex pattern is overly broad and may match order numbers, dates, or product codes as phone numbers.\n\nFile: src/helpers.ts:829\n\nCurrent: (\\+?[\\d\\s\\-\\.\\(\\)]{10,})\nFix: Use more specific pattern with digit groupings typical of phone numbers.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T09:46:03.177957+01:00","updated_at":"2025-12-23T09:56:19.481244+01:00","closed_at":"2025-12-23T09:56:19.481244+01:00","close_reason":"Improved phone regex to require at least 7 actual digits, preventing false positives on dates and measurements","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.8","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:03.179607+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ap4.9","title":"Add missing Zod validation constraints","description":"Multiple schemas lack proper validation:\n- averageRating lacks .min(1).max(5) (inconsistent with RatingsSummarySchema)\n- Count/frequency fields lack .nonnegative() or .int().nonnegative()\n- Required string fields allow empty strings\n\nFile: src/schemas/output.ts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T09:46:03.4934+01:00","updated_at":"2025-12-23T09:46:03.4934+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-ap4.9","depends_on_id":"pinmeto-location-mcp-ap4","type":"parent-child","created_at":"2025-12-23T09:46:03.494404+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-b6n","title":"Fix dead code - API failure detection in search_locations","description":"The check 'if (\\!data)' at line 178 never triggers because makePaginatedPinMeToRequest always returns [array, boolean]. When API fails, users see 'No locations found' instead of an error. Fix: check 'if (data.length === 0 \u0026\u0026 \\!areAllPagesFetched)' instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T20:57:08.622803+01:00","updated_at":"2025-12-18T21:00:36.075893+01:00","closed_at":"2025-12-18T21:00:36.075893+01:00","close_reason":"Fixed: Changed 'if (\\!data)' to 'if (data.length === 0 \u0026\u0026 \\!areAllPagesFetched)' to properly detect API failures"}
{"id":"pinmeto-location-mcp-bn3","title":"Add changeset validation CI check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T18:58:47.631976+01:00","updated_at":"2025-12-21T19:01:20.433356+01:00","closed_at":"2025-12-21T19:01:20.433356+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-bo2","title":"Surface comparison fetch failures instead of silent discard","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T21:34:59.72232+01:00","updated_at":"2025-12-21T21:37:47.290893+01:00","closed_at":"2025-12-21T21:37:47.290893+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-btm","title":"Move generic docs from CLAUDE.md to AGENTS.md","status":"closed","priority":2,"issue_type":"task","assignee":"Marcus Olsson","created_at":"2025-12-21T19:25:06.479065+01:00","updated_at":"2025-12-21T19:35:34.493419+01:00","closed_at":"2025-12-21T19:35:34.493419+01:00","close_reason":"PR #28 merged"}
{"id":"pinmeto-location-mcp-c4p","title":"Optimize response format to remove token waste","description":"Optimize response format to remove token waste. Review all tool responses for unnecessary verbosity, redundant fields, or inefficient formatting. Files: All tools in src/tools/, src/helpers.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Response analysis completed (token usage measured)\n- [ ] Unnecessary fields removed or made optional\n- [ ] Verbose metadata reduced\n- [ ] formatListResponse() optimized if needed\n- [ ] Output schemas updated to match optimized responses\n- [ ] Token reduction measured and documented (before/after)\n- [ ] Tests updated for optimized responses\n- [ ] Tests verify no data loss from optimization\n- [ ] Tool descriptions mention response optimization\n- [ ] CLAUDE.md updated with token efficiency patterns\n- [ ] Manually tested optimized responses with MCP Inspector\n- [ ] No functional regressions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T11:36:08.182926+01:00","updated_at":"2025-12-18T13:02:22.234173+01:00"}
{"id":"pinmeto-location-mcp-cox","title":"Add test for formatErrorResponse context parameter","description":"The context parameter in formatErrorResponse() that creates messages like 'Failed for storeId 12345: ...' has no direct unit test. Add test to verify context is prepended to error messages.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:56:33.609611+01:00","updated_at":"2025-12-19T14:01:31.017135+01:00","closed_at":"2025-12-19T14:01:31.017135+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-cyi","title":"Add YoY functionality to atomic network insights tools","description":"Add optional YoY comparison parameters to all 6 atomic insights tools (get_google_location_insights, get_facebook_location_insights, get_apple_location_insights + all variants). When compareYoY=true, fetch both current and previous year data, calculate change %, and return structured comparison. Response includes current/previous metrics, absolute change, percent change, and trend. Files: src/tools/networks/google.ts, facebook.ts, apple.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] compareYoY parameter added to all 6 insights tools\n- [ ] previousYearFrom and previousYearTo parameters added\n- [ ] YoY calculation logic implemented in helper function\n- [ ] Response structure includes current/previous/change\n- [ ] Output schemas updated with YoY comparison structure\n- [ ] Tool annotations maintained (readOnlyHint: true)\n- [ ] Tests added for YoY logic in each tool\n- [ ] Tests cover edge cases (missing data, equal values, negative changes)\n- [ ] Tool descriptions updated with YoY parameter docs\n- [ ] CLAUDE.md updated with YoY usage examples\n- [ ] Manually tested YoY with MCP Inspector (all 6 tools)\n- [ ] No regressions in non-YoY mode","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T12:52:54.125705+01:00","updated_at":"2025-12-18T12:59:11.512861+01:00"}
{"id":"pinmeto-location-mcp-d2i","title":"Add test for 401/403 during API request (post-token acquisition)","description":"Tests cover auth errors during token fetch, but there's no test for when a 401/403 occurs during a subsequent API request after successful token acquisition (e.g., token expired mid-session or revoked between requests).\n\n**What it would catch**: If the token caching logic doesn't properly handle token invalidation on auth failures, the system could repeatedly retry with a stale token.\n\n**Missing test scenario**:\n```typescript\nit('should return AUTH_INVALID_CREDENTIALS on 401 during API request (token expired)', async () =\u003e {\n  // First token fetch succeeds\n  vi.mocked(axios.post).mockResolvedValueOnce({ data: { access_token: testAccessToken } });\n  // But subsequent API request returns 401\n  vi.mocked(axios.get).mockRejectedValueOnce(\n    Object.assign(new Error('Unauthorized'), {\n      isAxiosError: true,\n      response: { status: 401, data: { message: 'Token expired' } }\n    })\n  );\n  // Verify AUTH_INVALID_CREDENTIALS is returned, not UNKNOWN_ERROR\n});\n```\n\nPR Review Reference: pr-test-analyzer agent identified this as Important (6/10).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T13:44:55.00907+01:00","updated_at":"2025-12-19T13:44:55.00907+01:00"}
{"id":"pinmeto-location-mcp-d3p","title":"Fix type duplication between helpers.ts and schemas/output.ts","description":"The MetricData and InsightsData interfaces are defined in both files, creating two sources of truth that could drift apart during maintenance.\n\n**Location:** \n- src/helpers.ts:10-18 (local interfaces)\n- src/schemas/output.ts:11-24 (exported from Zod schemas)\n\n**Current state:**\n```typescript\n// helpers.ts (local interfaces)\ninterface MetricData { key: string; value: number; }\ninterface InsightsData { key: string; metrics: MetricData[]; }\n\n// schemas/output.ts (exported from Zod schemas)\nexport type MetricData = z.infer\u003ctypeof MetricDataSchema\u003e;\nexport type InsightsData = z.infer\u003ctypeof InsightsDataSchema\u003e;\n```\n\n**Fix:** Replace local interfaces in helpers.ts with imports:\n```typescript\nimport { MetricData, InsightsData } from './schemas/output';\n```\n\n**Risk:** Low - simple refactor, types are functionally identical.\n\nPR Review Reference: type-design-analyzer agent identified this as type duplication concern.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:11:09.616881+01:00","updated_at":"2025-12-19T10:48:44.119002+01:00","closed_at":"2025-12-19T10:48:44.119002+01:00","close_reason":"PR #22 approved - duplicate type definitions removed from helpers.ts"}
{"id":"pinmeto-location-mcp-d44","title":"Add 429 rate limit handling in _getAndStoreToken","description":"The _getAndStoreToken method doesn't explicitly handle HTTP 429 (rate limited), leading to a generic error message instead of actionable guidance. Should add: if (status === 429) throw new AuthError('RATE_LIMITED', 'Authentication rate limited. Wait before retrying.');","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T13:56:32.406122+01:00","updated_at":"2025-12-19T14:01:30.980692+01:00","closed_at":"2025-12-19T14:01:30.980692+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-d77","title":"Add test for API failure error handling in search_locations","description":"Add test verifying error response when makePaginatedPinMeToRequest fails (network error, auth error, timeout). Currently no test covers the error path at lines 178-188.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T20:57:08.901235+01:00","updated_at":"2025-12-18T21:01:13.620052+01:00","closed_at":"2025-12-18T21:01:13.620052+01:00","close_reason":"Added test 'should return error response when API request fails' verifying error response when network fails","dependencies":[{"issue_id":"pinmeto-location-mcp-d77","depends_on_id":"pinmeto-location-mcp-b6n","type":"blocks","created_at":"2025-12-18T20:57:16.056368+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-d9i","title":"Make stale cache fallback explicit to users","description":"LocationCache silently returns stale data when API fails without informing users. Should return stale indicator so get_locations can warn users about data freshness.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T12:23:21.498316+01:00","updated_at":"2025-12-19T12:27:16.455805+01:00","closed_at":"2025-12-19T12:27:16.455805+01:00","close_reason":"Fixed: LocationCache now returns CacheResult with stale indicator, error, and staleAgeSeconds. get_locations uses formatErrorResponse() for consistent error handling."}
{"id":"pinmeto-location-mcp-ddb","title":"Add auth error handling tests for token fetch","description":"401/403/400 during token fetch have no test coverage. Need to test AUTH_INVALID_CREDENTIALS, AUTH_APP_DISABLED, BAD_REQUEST, and NETWORK_ERROR during authentication. Location: src/mcp_server.ts:131-179","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:19:56.387541+01:00","updated_at":"2025-12-19T13:22:04.808743+01:00","closed_at":"2025-12-19T13:22:04.808743+01:00","close_reason":"Added tests for 401/403/400/network errors during token fetch, and ApiResult error structure"}
{"id":"pinmeto-location-mcp-dz6","title":"Brand page insights 404 shows misleading 'store ID' error message","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-21T13:54:01.706193+01:00","updated_at":"2025-12-21T13:54:01.706193+01:00"}
{"id":"pinmeto-location-mcp-gh7","title":"Handle unexpected HTTP status codes explicitly","description":"Status codes like 405, 408, 422 fall through to UNKNOWN_ERROR with generic message. Should handle unhandled status codes with informative message including the status code.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-19T12:23:22.644279+01:00","updated_at":"2025-12-19T12:24:22.61261+01:00","closed_at":"2025-12-19T12:24:22.61261+01:00","close_reason":"Fixed in src/errors.ts - added extractApiErrorMessage() to preserve API response body and default case for unexpected HTTP status codes"}
{"id":"pinmeto-location-mcp-h7q","title":"Add progress reporting for long operations","description":"No feedback during long-running paginated requests (5000 locations = 10-30 seconds). Add progress notifications in makePaginatedPinMeToRequest. File: src/mcp_server.ts","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-18T11:36:09.807945+01:00","updated_at":"2025-12-18T11:36:09.807945+01:00"}
{"id":"pinmeto-location-mcp-hmz","title":"Update user documentation (README) when completing tasks that change user-facing behavior","description":"Before marking any task as complete, check if user-facing behavior changed and update README.md accordingly. This includes:\n- New tools or tool parameters\n- Changed tool behavior or output format\n- New configuration options\n- Changed environment variables\n- New features or workflows\n\nThis is a standing reminder - not a one-time task. Reference this issue in PRs that require doc updates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T21:33:21.910208+01:00","updated_at":"2025-12-18T23:12:07.56579+01:00","closed_at":"2025-12-18T23:12:07.56579+01:00","close_reason":"Standing reminder applied - README updated with version badges, one-click install links for VS Code/Cursor, and complete tools list in PR #21"}
{"id":"pinmeto-location-mcp-ikt","title":"Create get_combined_location_insights_yoy tool","description":"Create new combined YoY tool that fetches insights from multiple networks (Google, Facebook, Apple) and returns unified YoY comparison. Reduces multi-network YoY workflow from 6 calls to 1 call (83% reduction). Takes current/previous year date ranges, networks array, and aggregation. Returns per-network and total comparison with change %, trends. Files: src/tools/networks/combined.ts (new), src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] get_combined_location_insights_yoy tool created\n- [ ] Tool registered in src/mcp_server.ts\n- [ ] Input schema with date ranges and networks parameter\n- [ ] Output schema defined (comparison structure)\n- [ ] Fetches from all networks in parallel (Promise.all)\n- [ ] Calculates YoY changes (absolute, percent, trend)\n- [ ] Returns per-network and total summaries\n- [ ] Tool annotations added (readOnlyHint: true)\n- [ ] Tests added for combined YoY logic\n- [ ] Tests cover edge cases (missing data, network failures)\n- [ ] Tool description clear with usage example\n- [ ] CLAUDE.md updated with YoY workflow examples\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in existing tools","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T12:52:54.394399+01:00","updated_at":"2025-12-18T12:59:11.254358+01:00"}
{"id":"pinmeto-location-mcp-jcf","title":"Add test for null/missing address handling in search_locations","description":"Add test verifying behavior when location.address is null or address fields are null. Currently no test covers the addressSummary fallback to 'No address'.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T20:57:09.181136+01:00","updated_at":"2025-12-18T21:01:43.404302+01:00","closed_at":"2025-12-18T21:01:43.404302+01:00","close_reason":"Added test 'should handle locations with null or missing address fields gracefully' covering null address, partial address, and complete address scenarios"}
{"id":"pinmeto-location-mcp-jry","title":"Add consistent error field to success responses","description":"Error responses include error field but success responses don't. Makes it harder for AI clients to reliably detect errors. Fix: Include error: undefined in success responses or document the pattern. File: src/tools/locations/locations.ts:197-211","status":"closed","priority":2,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:29:00.413753+01:00","updated_at":"2025-12-18T22:31:55.394323+01:00","closed_at":"2025-12-18T22:31:55.394323+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-l6k","title":"Make AuthError retryable for NETWORK_ERROR","description":"AuthErrors always have retryable: false, but NETWORK_ERROR during auth SHOULD be retryable. Location: src/errors.ts:84-89","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:19:58.892878+01:00","updated_at":"2025-12-19T13:28:04.381512+01:00","closed_at":"2025-12-19T13:28:04.381512+01:00","close_reason":"AuthError with NETWORK_ERROR code now returns retryable: true"}
{"id":"pinmeto-location-mcp-lml","title":"Include error details in stale cache warning log","description":"The cache logs a warning when returning stale data but doesn't include the actual error that caused the failure.\n\n**Location**: src/cache/location-cache.ts:95-98\n\n**Current**:\n```typescript\nconsole.warn(\n  'Location fetch failed completely. Returning stale cache ' +\n    \\`(age: ${staleAgeSeconds}s, size: ${this.cache.data.length})\\`\n);\n```\n\n**Suggested**:\n```typescript\nconsole.warn(\n  \\`Location fetch failed completely (${error?.code || 'unknown'}): ${error?.message || 'no details'}. \\` +\n    \\`Returning stale cache (age: ${staleAgeSeconds}s, size: ${this.cache.data.length})\\`\n);\n```\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-19T13:45:37.258346+01:00","updated_at":"2025-12-19T13:45:37.258346+01:00"}
{"id":"pinmeto-location-mcp-lrb","title":"Fix computeComparison metric matching bug (always uses first prior metric)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T21:34:54.327675+01:00","updated_at":"2025-12-21T21:35:57.112025+01:00","closed_at":"2025-12-21T21:35:57.112025+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-m3g","title":"Surface partial pagination failures to users","description":"When pagination fails mid-stream, users get incomplete data without warning. The allPagesFetched flag is lost in response. Fix: Add warning/incomplete field to structuredContent when allPagesFetched === false. File: src/tools/locations/locations.ts:144-157, 197-211","status":"closed","priority":0,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.563815+01:00","updated_at":"2025-12-18T22:31:55.393061+01:00","closed_at":"2025-12-18T22:31:55.393061+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-maj","title":"Add logging before throwing AuthErrors","description":"AuthError in _getAndStoreToken throws without logging. Auth failures may not appear in logs if call path changes. Location: src/mcp_server.ts:148-187","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:57.041107+01:00","updated_at":"2025-12-19T13:23:48.050826+01:00","closed_at":"2025-12-19T13:23:48.050826+01:00","close_reason":"Added console.error logging before all AuthError throws"}
{"id":"pinmeto-location-mcp-mao","title":"Include URL in error log messages","description":"Error log only shows code and message, not which URL failed. Makes debugging harder. Location: src/mcp_server.ts:78","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:57.37482+01:00","updated_at":"2025-12-19T13:24:03.961025+01:00","closed_at":"2025-12-19T13:24:03.961025+01:00","close_reason":"Added URL to error log for easier debugging"}
{"id":"pinmeto-location-mcp-mm2","title":"Add page context to pagination error logs","description":"Pagination failure warning doesn't indicate which page failed or how many succeeded. Location: src/mcp_server.ts:96","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:57.704782+01:00","updated_at":"2025-12-19T13:24:24.201036+01:00","closed_at":"2025-12-19T13:24:24.201036+01:00","close_reason":"Added page context to pagination error logs showing record count"}
{"id":"pinmeto-location-mcp-mzr","title":"Improve output schemas for Ratings and Keywords (replace z.unknown())","description":"RatingsOutputSchema and KeywordsOutputSchema (src/schemas/output.ts:44-56) use z.unknown() for their data fields, providing no structural information to AI clients.\n\n**Current state:**\n```typescript\nexport const RatingsOutputSchema = {\n  data: z.unknown().describe('Ratings data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n\nexport const KeywordsOutputSchema = {\n  data: z.unknown().describe('Keywords data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n```\n\n**Type Design Analysis Ratings:**\n- Encapsulation: 3/10\n- Invariant Expression: 2/10\n- Usefulness: 3/10\n- Enforcement: 1/10\n\n**Recommendation:** Define at least partial schemas with known fields and .passthrough():\n```typescript\nexport const RatingsOutputSchema = {\n  data: z.object({\n    storeId: z.string().optional(),\n    averageRating: z.number().optional(),\n    totalReviews: z.number().optional(),\n    // ... other known fields\n  }).passthrough().describe('Ratings data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n```\n\n**Prerequisite:** Document actual API response shapes for ratings and keywords endpoints.\n\nPR Review Reference: type-design-analyzer agent rated these schemas at 2.25/10 overall.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T17:11:10.174818+01:00","updated_at":"2025-12-18T17:11:10.174818+01:00"}
{"id":"pinmeto-location-mcp-nzx","title":"Add unit tests for period comparison functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:35:21.284263+01:00","updated_at":"2025-12-21T21:44:45.29069+01:00","closed_at":"2025-12-21T21:44:45.29069+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-o9v","title":"Add period comparison support to MCP insights tools","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T21:15:24.712713+01:00","updated_at":"2025-12-22T18:12:12.459645+01:00","closed_at":"2025-12-22T18:12:12.459645+01:00","close_reason":"PR #30 merged with period comparison feature","dependencies":[{"issue_id":"pinmeto-location-mcp-o9v","depends_on_id":"pinmeto-location-mcp-v6h","type":"blocks","created_at":"2025-12-22T17:49:30.222162+01:00","created_by":"marcus","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-o9v","depends_on_id":"pinmeto-location-mcp-v04","type":"blocks","created_at":"2025-12-22T17:49:35.443671+01:00","created_by":"marcus","metadata":"{}"},{"issue_id":"pinmeto-location-mcp-o9v","depends_on_id":"pinmeto-location-mcp-qtf","type":"blocks","created_at":"2025-12-22T17:49:40.663538+01:00","created_by":"marcus","metadata":"{}"}]}
{"id":"pinmeto-location-mcp-ob7","title":"Improve tool naming consistency","description":"Inconsistent patterns (get_all_google_insights vs get_google_keywords). Standardize to {network}_{scope}_{resource} pattern. Add pinmeto_ service prefix per MCP best practice. Breaking change - needs versioning strategy. Files: src/tools/networks/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] All tools renamed with pinmeto_ prefix\n- [ ] Naming pattern {service}_{network}_{action}_{resource} applied\n- [ ] Version bump documented (breaking change)\n- [ ] Migration guide created for existing users\n- [ ] Tests updated with new tool names\n- [ ] All tool registrations updated in src/mcp_server.ts\n- [ ] Tool descriptions reference new names\n- [ ] CLAUDE.md updated with naming conventions\n- [ ] README updated with versioning info\n- [ ] Manually tested all renamed tools with MCP Inspector\n- [ ] No functionality regressions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:09.479805+01:00","updated_at":"2025-12-21T16:22:33.75529+01:00","closed_at":"2025-12-21T16:22:33.75529+01:00","close_reason":"PR #25 merged - all tools renamed with pinmeto_ prefix"}
{"id":"pinmeto-location-mcp-qtf","title":"Extract shared Zod schemas to input.ts","description":"DateSchema, AggregationSchema, and CompareWithSchema are duplicated across network tool files. Move to src/schemas/input.ts for reuse.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T17:49:16.541422+01:00","updated_at":"2025-12-22T17:56:48.149805+01:00","closed_at":"2025-12-22T17:56:48.149805+01:00","close_reason":"Deferred - P4 priority. Schema duplication is minimal and each tool has slightly different usage patterns."}
{"id":"pinmeto-location-mcp-rdr","title":"Fix hardcoded PACKAGE_VERSION in mcp_server.ts","description":"Currently PACKAGE_VERSION is hardcoded in src/mcp_server.ts:33 and must be manually updated on each release. This creates risk of version drift where the code reports a different version than package.json. Need to replace hardcoded constant with dynamic import from package.json to make it the single source of truth. Must be completed before next release to ensure version consistency.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T13:28:44.779145+01:00","updated_at":"2025-12-19T14:44:33.958328+01:00","closed_at":"2025-12-19T14:44:33.958328+01:00","close_reason":"Fixed by replacing hardcoded constant with dynamic import from package.json"}
{"id":"pinmeto-location-mcp-re2","title":"Enhance extractApiErrorMessage for nested error structures","description":"The extractApiErrorMessage function only checks top-level fields (message, error, error_description). Some APIs return nested error structures like { error: { message: '...' } } or { errors: [{ message: '...' }] }.\n\n**Location**: src/errors.ts:62-74\n\n**Hidden Errors**: Error messages from APIs with nested error structures.\n\n**Enhancement**:\n```typescript\nfunction extractApiErrorMessage(responseData: unknown): string | undefined {\n  if (\\!responseData || typeof responseData \\!== 'object') {\n    return undefined;\n  }\n  const data = responseData as Record\u003cstring, unknown\u003e;\n  \n  // Direct message fields\n  if (typeof data.message === 'string' \u0026\u0026 data.message) return data.message;\n  if (typeof data.error === 'string' \u0026\u0026 data.error) return data.error;\n  if (typeof data.error_description === 'string') return data.error_description;\n  \n  // Nested error object\n  if (data.error \u0026\u0026 typeof data.error === 'object') {\n    const nestedError = data.error as Record\u003cstring, unknown\u003e;\n    if (typeof nestedError.message === 'string') return nestedError.message;\n  }\n  \n  // Array of errors\n  if (Array.isArray(data.errors) \u0026\u0026 data.errors.length \u003e 0) {\n    const firstError = data.errors[0];\n    if (typeof firstError === 'string') return firstError;\n    if (typeof firstError?.message === 'string') return firstError.message;\n  }\n  \n  return undefined;\n}\n```\n\nPR Review Reference: silent-failure-hunter agent identified this as LOW severity.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-19T13:45:37.850432+01:00","updated_at":"2025-12-19T13:45:37.850432+01:00"}
{"id":"pinmeto-location-mcp-s64","title":"Clean up switch default case in mapAxiosErrorToApiError","description":"Default case falls through if status is undefined but response exists. Restructure for clarity. Location: src/errors.ts:152-163","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:19:59.341753+01:00","updated_at":"2025-12-19T13:28:50.04906+01:00","closed_at":"2025-12-19T13:28:50.04906+01:00","close_reason":"Restructured default case to always return, added block scope for clarity"}
{"id":"pinmeto-location-mcp-s6b","title":"Fix weak assertion in registerTool migration test","description":"The test 'should successfully invoke tools after migration to registerTool API' doesn't actually verify success.\n\n**Location**: tests/mcp_server.test.ts:416-447\n\n**Issue**:\n```typescript\nawait testTransport.close();\n// If we get here without errors, the migration was successful\nexpect(server).toBeDefined();  // Weak assertion - always true\n```\n\nThe test passes even though it produces an error in stderr (output validation error). This test should either be removed or strengthened to verify actual success.\n\nPR Review Reference: pr-test-analyzer agent identified this as Low (3/10).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-19T13:45:37.556611+01:00","updated_at":"2025-12-19T13:45:37.556611+01:00"}
{"id":"pinmeto-location-mcp-sde","title":"Fix cache storing failed fetches as valid data","description":"LocationCache unconditionally caches fetchFn results including failures. If API fails during refresh, users get empty results for 5 minutes with no error. Fix: Only cache successful fetches or keep stale data on failure. File: src/cache/location-cache.ts:44-46","status":"closed","priority":0,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.286233+01:00","updated_at":"2025-12-18T22:31:55.391909+01:00","closed_at":"2025-12-18T22:31:55.391909+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-suo","title":"Add non-negative constraint to totalMatches in SearchResultOutputSchema","description":"Change z.number() to z.number().nonnegative() for totalMatches field in src/schemas/output.ts to enforce the invariant that match counts cannot be negative.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-18T20:57:09.471319+01:00","updated_at":"2025-12-18T21:02:10.890179+01:00","closed_at":"2025-12-18T21:02:10.890179+01:00","close_reason":"Added .nonnegative() constraint to totalMatches in SearchResultOutputSchema"}
{"id":"pinmeto-location-mcp-t7t","title":"Improve stale cache test verification","description":"Test verifies stale: true but not error code or staleAgeSeconds. Location: tests/mcp_server.test.ts:1336-1378","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-19T13:19:59.780276+01:00","updated_at":"2025-12-19T13:29:37.819763+01:00","closed_at":"2025-12-19T13:29:37.819763+01:00","close_reason":"Stale cache test now verifies error code, retryable, and staleAgeSeconds"}
{"id":"pinmeto-location-mcp-u62","title":"Consolidate ApiErrorCode definitions","description":"Same error codes defined in both errors.ts and schemas/output.ts without linkage. Should export API_ERROR_CODES array from errors.ts and derive both type and Zod schema from it.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:23:22.352715+01:00","updated_at":"2025-12-19T12:28:11.802049+01:00","closed_at":"2025-12-19T12:28:11.802049+01:00","close_reason":"Consolidated: API_ERROR_CODES array in errors.ts is now single source of truth, Zod schema imports and uses it"}
{"id":"pinmeto-location-mcp-ubg","title":"Split Google ratings into ratings + reviews tools","description":"Split the current pinmeto_get_google_ratings tool into two focused tools for better context management with 100+ locations.\n\n**Problem**: Current tool returns union of 3 types, wastes tokens when only aggregates needed, no pagination for reviews.\n\n**Solution**:\n- pinmeto_get_google_ratings: Aggregate stats only (averageRating, totalReviews, distribution)\n- pinmeto_get_google_reviews: Detailed reviews with pagination and filters\n\n**Key features**:\n- Shared 5-minute cache between both tools\n- Reviews filters: minRating, maxRating, hasResponse\n- forceRefresh parameter on both tools\n\n## Completion Checklist\n- [ ] Implementation complete\n- [ ] Tests added and passing\n- [ ] Manual testing performed\n- [ ] README.md updated (if applicable)\n- [ ] Other documentation updated (if applicable)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T22:27:14.935213+01:00","updated_at":"2025-12-22T22:39:11.192825+01:00","closed_at":"2025-12-22T22:39:11.192825+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-ubg.1","title":"Update schemas (src/schemas/output.ts)","description":"Simplify RatingsOutputSchema to aggregate-only structure. Add new ReviewsOutputSchema with pagination metadata. Add ReviewSchema for individual review structure.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:38.645215+01:00","updated_at":"2025-12-22T22:29:40.800324+01:00","closed_at":"2025-12-22T22:29:40.800324+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.1","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:38.646942+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.2","title":"Add reviews formatter (src/formatters/reviews.ts)","description":"Create formatReviewsAsMarkdown() - table with rating, date, comment snippet, response status. Create formatLocationReviewsAsMarkdown() - single location variant. Truncate long comments in markdown view.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:38.956995+01:00","updated_at":"2025-12-22T22:30:22.81993+01:00","closed_at":"2025-12-22T22:30:22.81993+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.2","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:38.957507+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.3","title":"Update formatters index (src/formatters/index.ts)","description":"Export new reviews formatters from the index file.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:39.264706+01:00","updated_at":"2025-12-22T22:30:44.74055+01:00","closed_at":"2025-12-22T22:30:44.74055+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.3","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:39.265177+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.4","title":"Add shared cache (src/tools/networks/google.ts)","description":"Add reviews cache Map at module level. Add helper function getCachedOrFetchReviews(storeId, from, to, forceRefresh). Returns cached data if valid, otherwise fetches and caches. 5-minute TTL consistent with locations cache.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:39.574994+01:00","updated_at":"2025-12-22T22:32:20.060179+01:00","closed_at":"2025-12-22T22:32:20.060179+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.4","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:39.575408+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.5","title":"Refactor ratings tool (src/tools/networks/google.ts)","description":"Modify getGoogleRatings() to use getCachedOrFetchReviews(). Compute aggregates server-side: averageRating, totalReviews, distribution. Discard review text before returning. Add forceRefresh parameter. Update markdown formatter calls.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:39.887129+01:00","updated_at":"2025-12-22T22:33:24.153668+01:00","closed_at":"2025-12-22T22:33:24.153668+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.5","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:39.887528+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.6","title":"Add reviews tool (src/tools/networks/google.ts)","description":"Add getGoogleReviews() function with: input schema with pagination (limit/offset) and filters (minRating, maxRating, hasResponse). Use getCachedOrFetchReviews() for shared caching. Apply client-side filters and pagination. Return paginated response with metadata.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:40.204556+01:00","updated_at":"2025-12-22T22:34:18.298918+01:00","closed_at":"2025-12-22T22:34:18.298918+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.6","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:40.204887+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.7","title":"Register new tool (src/mcp_server.ts)","description":"Import getGoogleReviews from google.ts. Call getGoogleReviews(server) in createMcpServer().","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:40.530399+01:00","updated_at":"2025-12-22T22:35:05.691651+01:00","closed_at":"2025-12-22T22:35:05.691651+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.7","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:40.530806+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.8","title":"Add tests for ratings/reviews split","description":"Test ratings aggregation computation. Test reviews pagination. Test reviews filters (rating range, hasResponse). Test cache behavior (hit, miss, forceRefresh).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:40.845393+01:00","updated_at":"2025-12-22T22:37:55.236768+01:00","closed_at":"2025-12-22T22:37:55.236768+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.8","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:40.845765+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-ubg.9","title":"Update documentation (AGENTS.md)","description":"Update AGENTS.md tool table (10 tools  11 tools). Add reviews tool usage examples. Document breaking change for ratings tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T22:27:41.165583+01:00","updated_at":"2025-12-22T22:39:11.046214+01:00","closed_at":"2025-12-22T22:39:11.046214+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-ubg.9","depends_on_id":"pinmeto-location-mcp-ubg","type":"parent-child","created_at":"2025-12-22T22:27:41.165941+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-usk","title":"Test makePinMeToRequest error case structure","description":"Test verifies success case {ok: true, data} but not error case {ok: false, error: ApiError}. Location: tests/mcp_server.test.ts:90-97","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:19:58.455724+01:00","updated_at":"2025-12-19T13:22:04.818143+01:00","closed_at":"2025-12-19T13:22:04.818143+01:00","close_reason":"Added tests for 401/403/400/network errors during token fetch, and ApiResult error structure"}
{"id":"pinmeto-location-mcp-v04","title":"Extract shared comparison logic to helper function","description":"The comparison logic is nearly identical across google.ts, facebook.ts, apple.ts (~50 lines each). Extract to a shared processInsightsWithComparison() helper to reduce duplication and improve maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T17:49:11.152186+01:00","updated_at":"2025-12-22T17:56:42.773528+01:00","closed_at":"2025-12-22T17:56:42.773528+01:00","close_reason":"Added finalizeInsights() helper to centralize comparison embedding and flattening. Refactored Google, Facebook (insights + brand page), and Apple insights to use it."}
{"id":"pinmeto-location-mcp-v6h","title":"Add markdown format support to Facebook/Apple insights","description":"Facebook and Apple insights tools always output JSON regardless of response_format parameter. Google insights properly handles markdown with formatters. Add the same markdown formatting logic to Facebook and Apple for consistency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T17:49:05.762169+01:00","updated_at":"2025-12-22T17:51:44.867183+01:00","closed_at":"2025-12-22T17:51:44.867183+01:00","close_reason":"Added markdown format support to Facebook (insights + brand page) and Apple insights tools matching Google's implementation"}
{"id":"pinmeto-location-mcp-vri","title":"Improve error messages with actionable guidance","description":"Error messages are generic ('Unable to fetch insights data'). Improve with actionable guidance, error codes, and specific next steps. MCP best practice: provide helpful, specific error messages. Files: All tools in src/tools/, src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Error messages include specific failure reasons\n- [ ] Actionable next steps provided (check auth, retry, etc.)\n- [ ] HTTP status codes included where applicable\n- [ ] Rate limit errors have clear guidance\n- [ ] Authentication errors specify auth method\n- [ ] Network errors distinguish timeout vs connection failure\n- [ ] Tests added for error scenarios\n- [ ] Tests verify error message quality\n- [ ] Tool descriptions mention error handling\n- [ ] CLAUDE.md updated with error handling patterns\n- [ ] Manually tested error scenarios with MCP Inspector\n- [ ] No regressions in successful path functionality","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:07.592312+01:00","updated_at":"2025-12-21T20:55:10.545429+01:00","closed_at":"2025-12-21T20:55:10.545429+01:00","close_reason":"Completed: docs improve workflow documentation with branching and beads guidelines (commit 88fa875)"}
{"id":"pinmeto-location-mcp-vxb","title":"Add response format flexibility (JSON vs Markdown)","description":"MCP best practice: 'All tools that return data should support multiple formats.' Add response_format parameter (json/markdown) to all tools. JSON for programmatic processing, Markdown for human readability. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] response_format parameter added to all 13 tools\n- [ ] JSON format returns structured data\n- [ ] Markdown format returns human-readable text with headers/lists\n- [ ] Output schemas support both formats\n- [ ] Default format documented per tool\n- [ ] Tests added for both response formats\n- [ ] Tests verify format switching works correctly\n- [ ] Tool descriptions updated with format examples\n- [ ] CLAUDE.md updated with format selection guidance\n- [ ] Manually tested both formats with MCP Inspector\n- [ ] No regressions in tool functionality","status":"closed","priority":1,"issue_type":"feature","assignee":"Marcus Olsson","created_at":"2025-12-18T12:38:24.460065+01:00","updated_at":"2025-12-21T14:25:39.291622+01:00","closed_at":"2025-12-21T14:25:39.291622+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-wjn","title":"Add test for missing access_token in OAuth response","description":"The code handles malformed OAuth responses (200 OK but no access_token), but no test covers this path. Add test to verify AUTH_INVALID_CREDENTIALS is returned when OAuth response lacks access_token field.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:56:32.707226+01:00","updated_at":"2025-12-19T14:01:30.990119+01:00","closed_at":"2025-12-19T14:01:30.990119+01:00","close_reason":"Fixed in PR review session"}
{"id":"pinmeto-location-mcp-wu0","title":"Add integration tests verifying error structure across all 16 tools","description":"While formatErrorResponse() is unit-tested, there's no end-to-end test verifying that **all 16 tools** correctly return the structured error fields (errorCode, retryable) in their responses.\n\n**What it would catch**: A tool accidentally omitting formatErrorResponse() or returning inconsistent error structure.\n\n**Current coverage**: Only get_location and search_locations verify error response structure.\n\n**Suggested approach**: Create parametrized tests or a test loop that verifies each tool returns proper error structure on failure.\n\nPR Review Reference: pr-test-analyzer agent identified this as Important (6/10).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T13:44:55.299942+01:00","updated_at":"2025-12-19T13:44:55.299942+01:00"}
{"id":"pinmeto-location-mcp-x08","title":"Use console.warn for expected auth failures (401/403)","description":"The _getAndStoreToken() method uses console.error for all authentication failures, but 401/403/400 are expected failure scenarios indicating user configuration issues, not internal server errors.\n\n**Location**: src/mcp_server.ts:161-193\n\nUsing console.error for expected failures may create noise in logs and make log analysis more difficult.\n\n**Recommendation**: Use console.warn for expected authentication failures since these are user-actionable issues. Reserve console.error for truly unexpected failures.\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-19T13:45:33.409035+01:00","updated_at":"2025-12-19T13:45:33.409035+01:00"}
{"id":"pinmeto-location-mcp-xp2","title":"Add test for makePaginatedPinMeToRequest partial failure","description":"Add a unit test to verify behavior when pagination fails mid-stream (e.g., first page succeeds, second page fails).\n\n**Context from PR Review:**\nThe test coverage analysis identified that `makePaginatedPinMeToRequest` has no test for partial failure scenarios. The implementation at `src/mcp_server.ts:92-111` handles partial failures by returning collected data with `areAllPagesFetched: false` and `lastError`, but this behavior is not verified by tests.\n\n**Suggested Test:**\n```typescript\nit('should return partial data with error when pagination fails mid-stream', async () =\u003e {\n  let callCount = 0;\n  vi.mocked(axios.get).mockImplementation((url: string) =\u003e {\n    callCount++;\n    if (callCount === 1) {\n      return Promise.resolve({\n        data: { data: [{ id: 1 }], paging: { nextUrl: 'page2' } }\n      });\n    }\n    // Second page fails\n    const error = Object.assign(new Error('Server Error'), {\n      isAxiosError: true,\n      response: { status: 500 }\n    });\n    return Promise.reject(error);\n  });\n\n  const server = createMcpServer();\n  server.configs.accessToken = testAccessToken;\n  server.configs.accessTokenTime = Date.now() / 1000;\n\n  const [data, allPagesFetched, lastError] = await server.makePaginatedPinMeToRequest(url);\n  \n  expect(data).toEqual([{ id: 1 }]); // Partial data preserved\n  expect(allPagesFetched).toBe(false);\n  expect(lastError?.code).toBe('SERVER_ERROR');\n});\n```\n\n**Why it matters:**\nWithout this test, a regression could cause partial data to be silently discarded or the error context to be lost during pagination.\n\nPR Review Reference: pr-test-analyzer rated this 6/10 priority.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T14:13:17.196083+01:00","updated_at":"2025-12-19T14:13:29.832472+01:00"}
{"id":"pinmeto-location-mcp-zck","title":"Add rate limiting and retry logic","description":"Add rate limiting detection and retry logic with exponential backoff. Handle 429 responses gracefully. Respect API rate limits. Files: src/mcp_server.ts, src/helpers.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Rate limit detection implemented (429 status code)\n- [ ] Retry logic with exponential backoff added\n- [ ] Configurable retry attempts and delays\n- [ ] Retry-After header respected if present\n- [ ] Rate limit errors have actionable messages\n- [ ] Circuit breaker pattern considered\n- [ ] Tests added for rate limiting scenarios\n- [ ] Tests verify retry logic with mocked 429 responses\n- [ ] CLAUDE.md updated with rate limiting behavior\n- [ ] Manually tested rate limit handling\n- [ ] Tool descriptions mention retry behavior\n- [ ] No infinite retry loops","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T11:36:07.886561+01:00","updated_at":"2025-12-18T13:02:22.520299+01:00"}

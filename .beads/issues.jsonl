{"id":"pinmeto-location-mcp-1j5","title":"Add outputSchema to all tools","description":"Missing output schema declarations. Add Zod output schemas to all tool registrations for better AI understanding and validation. Modern MCP best practice. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Output schemas defined for all 13 tools using Zod\n- [ ] Schemas match actual response structure\n- [ ] Tool registrations include outputSchema parameter\n- [ ] Tests added to validate output against schema\n- [ ] Tool descriptions mention output structure\n- [ ] CLAUDE.md updated with outputSchema examples\n- [ ] Manually tested with MCP Inspector (verify schema display)\n- [ ] No regressions in tool functionality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:08.508063+01:00","updated_at":"2025-12-18T16:54:29.482664+01:00","closed_at":"2025-12-18T16:54:29.482664+01:00","close_reason":"Implemented outputSchema for all 15 tools with structuredContent returns"}
{"id":"pinmeto-location-mcp-277","title":"Add cache TTL expiration test","description":"The isExpired() logic (5-minute TTL) is never tested. If comparison operator were reversed, cache would never expire. Fix: Add test using vi.useFakeTimers() to verify TTL behavior. File: tests/mcp_server.test.ts","status":"closed","priority":1,"issue_type":"task","assignee":"Marcus Olsson","created_at":"2025-12-18T22:29:00.127806+01:00","updated_at":"2025-12-18T22:31:55.393952+01:00","closed_at":"2025-12-18T22:31:55.393952+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-27l","title":"Add tool annotations (readOnlyHint)","description":"No readOnlyHint or other annotations. Add readOnlyHint: true to all tools since they're all read-only. Helps AI agents plan better. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] readOnlyHint: true added to all 13 tools\n- [ ] Tool annotations verified in tool registrations\n- [ ] Tests updated to verify annotations present\n- [ ] CLAUDE.md updated with annotation conventions\n- [ ] Manually tested with MCP Inspector (verify annotations visible)\n- [ ] No regressions in tool functionality","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T11:36:08.818779+01:00","updated_at":"2025-12-18T16:18:08.906888+01:00","closed_at":"2025-12-18T16:18:08.906888+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-27l","depends_on_id":"pinmeto-location-mcp-2bp","type":"blocks","created_at":"2025-12-18T15:39:28.338938+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-2bp","title":"PR #17 Review Fixes - Tool Annotations","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T15:37:16.399934+01:00","updated_at":"2025-12-18T15:53:51.71008+01:00","closed_at":"2025-12-18T15:53:51.71008+01:00","close_reason":"Closed","dependencies":[{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-6kn","type":"blocks","created_at":"2025-12-18T15:37:45.610474+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-afq","type":"blocks","created_at":"2025-12-18T15:37:45.724351+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-8a6","type":"blocks","created_at":"2025-12-18T15:37:45.837018+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-2bp","depends_on_id":"pinmeto-location-mcp-3jl","type":"blocks","created_at":"2025-12-18T15:37:45.948766+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-2eu","title":"Create workflow helper tools","description":"Users manually orchestrate multi-step workflows. Create analyze_location_performance tool combining multiple network insights in one call. File: src/tools/helpers/workflows.ts (new)","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-18T11:36:10.15086+01:00","updated_at":"2025-12-18T11:36:10.15086+01:00"}
{"id":"pinmeto-location-mcp-2pt","title":"Add response caching for frequently accessed data","description":"No caching of location data. Add simple TTL cache (5-10 minutes) for get_locations and get_location. Reduces API load and improves response time. File: src/mcp_server.ts","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-18T11:36:10.480664+01:00","updated_at":"2025-12-18T11:36:10.480664+01:00"}
{"id":"pinmeto-location-mcp-33c","title":"Standardize date format consistency across tools","description":"Inconsistent date formats: keywords use YYYY-MM while insights use YYYY-MM-DD. Standardize all tools to YYYY-MM-DD for consistency. Breaking change but improves UX. Files: src/tools/networks/google.ts (keywords tools)\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] All tools use YYYY-MM-DD format\n- [ ] Keywords tools updated from YYYY-MM to YYYY-MM-DD\n- [ ] Input schemas updated with consistent date format\n- [ ] Date parsing logic updated\n- [ ] Version bump documented (breaking change if needed)\n- [ ] Migration guide created if breaking change\n- [ ] Tests updated with new date format\n- [ ] Tests verify format consistency across tools\n- [ ] Tool descriptions updated with date format\n- [ ] CLAUDE.md updated with date format standard\n- [ ] Manually tested all date inputs with MCP Inspector\n- [ ] No regressions in date handling","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:24.729235+01:00","updated_at":"2025-12-18T13:02:21.95008+01:00"}
{"id":"pinmeto-location-mcp-3jl","title":"Fix annotation test to verify readOnlyHint","description":"Test 'should register all 15 tools with readOnlyHint annotations' only checks expect(server).toBeDefined() - doesn't actually verify annotations exist on tools.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T15:37:27.431911+01:00","updated_at":"2025-12-18T15:53:18.126117+01:00","closed_at":"2025-12-18T15:53:18.126117+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-3zf","title":"Create search_locations lightweight discovery tool","description":"Create lightweight search/discovery tool for finding locations by name, address, or ID patterns. Complements get_locations by providing fuzzy search without fetching full location data. Files: src/tools/locations/locations.ts, src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] search_locations tool implemented and registered\n- [ ] Input schema with search query and optional filters\n- [ ] Output schema defined (location ID, name, address summary)\n- [ ] Tool annotations added (readOnlyHint: true)\n- [ ] Pagination support (limit parameter)\n- [ ] Tests added for search functionality\n- [ ] Tests cover edge cases (empty results, special characters)\n- [ ] Tool description clear and actionable\n- [ ] CLAUDE.md updated with search examples\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in existing location tools","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:07.298439+01:00","updated_at":"2025-12-18T21:02:18.920246+01:00","closed_at":"2025-12-18T21:02:18.920246+01:00","close_reason":"Feature complete: search_locations tool with bug fix, comprehensive tests, and schema improvements","dependencies":[{"issue_id":"pinmeto-location-mcp-3zf","depends_on_id":"pinmeto-location-mcp-b6n","type":"blocks","created_at":"2025-12-18T20:59:22.854587+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-3zf","depends_on_id":"pinmeto-location-mcp-d77","type":"blocks","created_at":"2025-12-18T20:59:22.976994+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-43x","title":"Add specific error handling for authentication failures","description":"The _getAndStoreToken() method (src/mcp_server.ts:96-119) throws errors that bubble up to makePinMeToRequest's catch block, losing authentication-specific context.\n\nHidden errors that get swallowed:\n- HTTP 401 when credentials are invalid\n- HTTP 403 when OAuth app is disabled/revoked\n- HTTP 400 for malformed grant request\n- Network errors reaching the OAuth endpoint\n\nShould wrap token fetching errors with clear authentication context:\n```typescript\nif (axios.isAxiosError(e) \u0026\u0026 e.response?.status === 401) {\n  throw new Error('Authentication failed: Invalid PINMETO_APP_ID or PINMETO_APP_SECRET');\n}\n```\n\nDepends on pinmeto-location-mcp-5gt (structured errors) being completed first.\n\nPR Review Reference: silent-failure-hunter agent identified this as HIGH severity.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T16:06:16.387076+01:00","updated_at":"2025-12-18T17:10:35.119157+01:00","dependencies":[{"issue_id":"pinmeto-location-mcp-43x","depends_on_id":"pinmeto-location-mcp-5gt","type":"blocks","created_at":"2025-12-18T16:06:25.938486+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-5el","title":"Add input validation for date ranges","description":"No validation that 'from' date \u003c 'to' date. Add Zod refinements to validate date ranges before API calls. Improves error messages and prevents invalid API requests. Files: All tools with date parameters in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Zod refinements added to all tools with date ranges\n- [ ] Validation ensures from \u003c to\n- [ ] Validation checks date format (YYYY-MM-DD)\n- [ ] Validation checks dates are not in future (if applicable)\n- [ ] Clear error messages for validation failures\n- [ ] Tests added for date validation logic\n- [ ] Tests cover edge cases (equal dates, reversed dates, invalid formats)\n- [ ] Tool descriptions mention date validation\n- [ ] CLAUDE.md updated with date validation examples\n- [ ] Manually tested invalid dates with MCP Inspector\n- [ ] No regressions in valid date handling","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:25.006254+01:00","updated_at":"2025-12-18T13:02:21.674932+01:00"}
{"id":"pinmeto-location-mcp-5gt","title":"Return structured errors instead of null from API requests","description":"The makePinMeToRequest method (src/mcp_server.ts:48-62) catches all exceptions with a broad 'catch (e: any)' and returns null, making it impossible to distinguish between:\n- HTTP 401 Unauthorized (expired/invalid token)\n- HTTP 403 Forbidden (insufficient permissions)\n- HTTP 404 Not Found (invalid storeId)\n- HTTP 400 Bad Request (malformed date format)\n- HTTP 429 Rate Limited\n- HTTP 500/503 Server Errors\n- Network timeout (ETIMEDOUT)\n- DNS resolution failure (ENOTFOUND)\n- Connection refused (ECONNREFUSED)\n- SSL certificate errors\n- Token fetch failure during _getPinMeToAccessToken()\n\nShould return structured error objects like:\n```typescript\n{ data?: any; error?: { code: string; message: string; statusCode?: number } }\n```\n\nThis is CRITICAL because with the new structuredContent.error field (from outputSchema PR), all 15 tools return the same generic 'Unable to fetch X data' message regardless of root cause. AI clients cannot provide actionable guidance.\n\nPR Review Reference: silent-failure-hunter agent identified this as CRITICAL severity.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T16:06:16.106816+01:00","updated_at":"2025-12-18T17:10:34.860493+01:00"}
{"id":"pinmeto-location-mcp-5tq","title":"Fix race condition in cache population","description":"Multiple concurrent requests on expired cache trigger separate API fetches. For 5000+ locations this wastes bandwidth. Fix: Implement promise deduplication - cache the fetch promise itself. File: src/cache/location-cache.ts:39-46","status":"closed","priority":1,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.847919+01:00","updated_at":"2025-12-18T22:31:55.39354+01:00","closed_at":"2025-12-18T22:31:55.39354+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-6a5","title":"Fix empty results treated as errors in get_locations","description":"The get_locations tool (src/tools/locations/locations.ts:112-125) conflates 'API failed' with 'no locations exist'. An account with zero locations receives an error message when it should receive an empty array with no error.\n\n**Current behavior:**\n```typescript\nconst [data, areAllPagesFetched] = await server.makePaginatedPinMeToRequest(url);\nif (\\!data || data.length === 0) {\n  return {\n    content: [{ type: 'text', text: 'Unable to fetch location data.' }],\n    structuredContent: {\n      data: [],\n      allPagesFetched: false,\n      error: 'Unable to fetch location data.'\n    }\n  };\n}\n```\n\n**Expected behavior:**\n```typescript\n// Check if the API call itself failed (first page returned null)\nif (data === null) {\n  return {\n    content: [{ type: 'text', text: 'Unable to fetch location data from PinMeTo API.' }],\n    structuredContent: {\n      data: [],\n      allPagesFetched: false,\n      error: 'API request failed. Check credentials and connectivity.'\n    }\n  };\n}\n\n// Empty results are valid, not an error\nif (data.length === 0) {\n  return {\n    content: [{ type: 'text', text: 'No locations found for this account.' }],\n    structuredContent: { data: [], allPagesFetched: true }\n  };\n}\n```\n\n**User Impact:** AI clients cannot distinguish between 'this account has no locations' (valid state) and 'the API call failed' (error state).\n\nPR Review Reference: silent-failure-hunter agent identified this as HIGH severity.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:11:09.893077+01:00","updated_at":"2025-12-18T23:27:20.195906+01:00","closed_at":"2025-12-18T23:27:20.195906+01:00","close_reason":"Already fixed - code now distinguishes empty results (allPagesFetched=true) from API failures (allPagesFetched=false) in get_locations, search_locations, and LocationCache"}
{"id":"pinmeto-location-mcp-6kn","title":"Fix CLAUDE.md env loading documentation","description":"CLAUDE.md states env vars are loaded via process.loadEnvFile() but this was removed. Update to reflect --env-file=.env.local approach in npm scripts.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-18T15:37:26.596608+01:00","updated_at":"2025-12-18T15:52:08.578352+01:00","closed_at":"2025-12-18T15:52:08.578352+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-7ru","title":"Add comprehensive tool-level testing","description":"Current tests only cover core server. MCP requirement: 'Comprehensive testing should cover functional, integration, security, performance.' Add tool-level tests with mock API responses for all 15 tools. Files: tests/ directory\n\n**NEW from PR Review (outputSchema PR):**\nThe pr-test-analyzer found critical test gaps:\n1. No tests verify structuredContent.data is returned on successful tool calls\n2. No tests verify structuredContent.error is returned on API failures\n3. No tests verify response shapes match declared outputSchemas\n4. No tests for empty data scenarios (0 locations vs API failure)\n\nSuggested tests:\n```typescript\nit('should return structuredContent.data on successful get_location call', async () =\u003e {\n  // Mock a successful API response\n  // Invoke get_location tool\n  // Verify response includes structuredContent.data matching LocationOutputSchema\n});\n\nit('should return structuredContent.error when API returns null', async () =\u003e {\n  // Mock API to return null\n  // Invoke tool\n  // Verify response includes structuredContent.error\n});\n\nit('should return data conforming to InsightsOutputSchema', async () =\u003e {\n  const result = await invokeGoogleInsights();\n  expect(() =\u003e z.object(InsightsOutputSchema).parse(result.structuredContent)).not.toThrow();\n});\n```\n\nPR Review Reference: pr-test-analyzer agent rated test coverage gaps at 9/10 severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T12:38:25.28202+01:00","updated_at":"2025-12-18T17:10:35.397209+01:00"}
{"id":"pinmeto-location-mcp-84q","title":"Add date validation in aggregateMetrics and getPeriodKey","description":"The getPeriodKey function (src/helpers.ts:86-115) parses date strings without validation. Invalid dates silently produce NaN values that propagate through aggregation.\n\n**Current behavior:**\n```typescript\nfunction getPeriodKey(dateStr: string, period: AggregationPeriod): string {\n  const date = new Date(dateStr);  // No validation - could be Invalid Date\n  const year = date.getFullYear();  // Returns NaN for invalid dates\n  const month = date.getMonth();    // Returns NaN for invalid dates\n  ...\n}\n```\n\n**Problem:** If the API returns dates in an unexpected format, aggregation produces keys like 'NaN-NaN' or 'NaN-Q1' without any error indication.\n\n**Recommended fix:**\n```typescript\nfunction getPeriodKey(dateStr: string, period: AggregationPeriod): string {\n  const date = new Date(dateStr);\n  if (isNaN(date.getTime())) {\n    console.error(`Invalid date string for aggregation: \"${dateStr}\"`);\n    return dateStr; // Fall back to original key\n  }\n  ...\n}\n```\n\nAlso add defensive checks in aggregateMetrics():\n```typescript\nif (\\!insightData || typeof insightData.key \\!== 'string') {\n  console.error(`Invalid insight data at index ${index}: missing key`);\n  return { key: 'unknown', metrics: [] };\n}\n\nif (\\!Array.isArray(insightData.metrics)) {\n  console.error(`Invalid metrics for insight ${insightData.key}: not an array`);\n  return { key: insightData.key, metrics: [] };\n}\n```\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T17:11:21.045395+01:00","updated_at":"2025-12-18T17:11:21.045395+01:00"}
{"id":"pinmeto-location-mcp-8a6","title":"Add test for Initialize handler capabilities fix","description":"The bug fix returning serverInfo.capabilities instead of request.params.capabilities has no test coverage. Add test verifying server returns its own capabilities, not client's.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T15:37:27.146519+01:00","updated_at":"2025-12-18T15:53:18.127+01:00","closed_at":"2025-12-18T15:53:18.127+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-8et","title":"Add pagination/filtering to get_locations","description":"Add pagination support (limit, offset) and filtering capabilities to get_locations tool. Currently fetches all locations with hardcoded pagesize=1000. Files: src/tools/locations/locations.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Limit parameter added (default: 50, max: 1000)\n- [ ] Offset parameter added for pagination\n- [ ] Filter parameters added (status, type, etc.)\n- [ ] Response includes pagination metadata (has_more, total_count)\n- [ ] Output schema updated with pagination fields\n- [ ] Tests added for pagination logic\n- [ ] Tests cover edge cases (limit=0, large offsets)\n- [ ] Tool description updated with pagination examples\n- [ ] CLAUDE.md updated with pagination patterns\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in get_locations functionality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-18T11:36:07.006914+01:00","updated_at":"2025-12-18T22:39:38.504732+01:00","closed_at":"2025-12-18T22:39:38.504732+01:00","close_reason":"All subtasks completed. Pagination, filtering, caching implemented with fixes for cache error handling, race conditions, and incomplete data warnings.","dependencies":[{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-sde","type":"blocks","created_at":"2025-12-18T22:29:05.499204+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-m3g","type":"blocks","created_at":"2025-12-18T22:29:05.609909+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-5tq","type":"blocks","created_at":"2025-12-18T22:29:05.720183+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-277","type":"blocks","created_at":"2025-12-18T22:29:05.83056+01:00","created_by":"daemon"},{"issue_id":"pinmeto-location-mcp-8et","depends_on_id":"pinmeto-location-mcp-jry","type":"blocks","created_at":"2025-12-18T22:29:05.94071+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-9wk","title":"Track pagination progress and report partial data context","description":"makePaginatedPinMeToRequest (src/mcp_server.ts:64-83) silently continues on partial failure, returning partial data with allPagesFetched=false but no context about how incomplete it is (10% vs 99%). Users may make decisions based on incomplete data without knowing the severity.\n\n**NEW from PR Review (outputSchema PR):**\nThe get_locations tool returns structuredContent without a warning when pagination fails:\n```typescript\nstructuredContent: { data, allPagesFetched: areAllPagesFetched }\n// ^ No warning field, even though pagination failed partway\n```\n\nRecommended fix:\n```typescript\nstructuredContent: { \n  data, \n  allPagesFetched: areAllPagesFetched,\n  ...(areAllPagesFetched ? {} : { warning: 'Pagination interrupted. Results may be incomplete.' })\n}\n```\n\nShould also track page numbers (e.g., 'Fetched 3 of unknown pages') and provide context about what was successfully fetched.\n\nPR Review Reference: silent-failure-hunter agent identified this as MEDIUM severity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T16:06:16.660636+01:00","updated_at":"2025-12-18T17:10:35.657627+01:00"}
{"id":"pinmeto-location-mcp-adi","title":"Migrate to structured content (type: json)","description":"**STATUS: Largely completed by outputSchema PR (feat/output-schema-all-tools)**\n\nOriginal goal was to migrate from type:'text' to type:'json'. However, the modern MCP pattern (per MCP builder skill) is actually:\n- Keep type:'text' in content array (for legacy clients)\n- ADD structuredContent field (for modern AI clients)\n\nThe outputSchema PR implements this pattern:\n```typescript\nreturn {\n  content: [{ type: 'text', text: JSON.stringify(data) }],\n  structuredContent: { data: aggregatedData }  // Modern pattern\n};\n```\n\n**What's done:**\n- All 15 tools return structuredContent alongside content\n- Output schemas defined in src/schemas/output.ts\n- Tests verify outputSchema is present on all tools\n\n**Remaining work (minor):**\n- Consider whether type:'text' with JSON.stringify is optimal or if type:'json' would be better for the content field\n- Verify MCP SDK version supports both patterns\n\nThis bead can likely be closed once the outputSchema PR is merged.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:09.147196+01:00","updated_at":"2025-12-18T17:11:37.328478+01:00"}
{"id":"pinmeto-location-mcp-afq","title":"Fix typo 'aggregration' in google.ts","description":"In get_all_google_insights tool description, 'no aggregration' should be 'no aggregation'","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T15:37:26.871023+01:00","updated_at":"2025-12-18T15:51:49.987231+01:00","closed_at":"2025-12-18T15:51:49.987231+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-b6n","title":"Fix dead code - API failure detection in search_locations","description":"The check 'if (\\!data)' at line 178 never triggers because makePaginatedPinMeToRequest always returns [array, boolean]. When API fails, users see 'No locations found' instead of an error. Fix: check 'if (data.length === 0 \u0026\u0026 \\!areAllPagesFetched)' instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-18T20:57:08.622803+01:00","updated_at":"2025-12-18T21:00:36.075893+01:00","closed_at":"2025-12-18T21:00:36.075893+01:00","close_reason":"Fixed: Changed 'if (\\!data)' to 'if (data.length === 0 \u0026\u0026 \\!areAllPagesFetched)' to properly detect API failures"}
{"id":"pinmeto-location-mcp-c4p","title":"Optimize response format to remove token waste","description":"Optimize response format to remove token waste. Review all tool responses for unnecessary verbosity, redundant fields, or inefficient formatting. Files: All tools in src/tools/, src/helpers.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Response analysis completed (token usage measured)\n- [ ] Unnecessary fields removed or made optional\n- [ ] Verbose metadata reduced\n- [ ] formatListResponse() optimized if needed\n- [ ] Output schemas updated to match optimized responses\n- [ ] Token reduction measured and documented (before/after)\n- [ ] Tests updated for optimized responses\n- [ ] Tests verify no data loss from optimization\n- [ ] Tool descriptions mention response optimization\n- [ ] CLAUDE.md updated with token efficiency patterns\n- [ ] Manually tested optimized responses with MCP Inspector\n- [ ] No functional regressions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T11:36:08.182926+01:00","updated_at":"2025-12-18T13:02:22.234173+01:00"}
{"id":"pinmeto-location-mcp-cyi","title":"Add YoY functionality to atomic network insights tools","description":"Add optional YoY comparison parameters to all 6 atomic insights tools (get_google_location_insights, get_facebook_location_insights, get_apple_location_insights + all variants). When compareYoY=true, fetch both current and previous year data, calculate change %, and return structured comparison. Response includes current/previous metrics, absolute change, percent change, and trend. Files: src/tools/networks/google.ts, facebook.ts, apple.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] compareYoY parameter added to all 6 insights tools\n- [ ] previousYearFrom and previousYearTo parameters added\n- [ ] YoY calculation logic implemented in helper function\n- [ ] Response structure includes current/previous/change\n- [ ] Output schemas updated with YoY comparison structure\n- [ ] Tool annotations maintained (readOnlyHint: true)\n- [ ] Tests added for YoY logic in each tool\n- [ ] Tests cover edge cases (missing data, equal values, negative changes)\n- [ ] Tool descriptions updated with YoY parameter docs\n- [ ] CLAUDE.md updated with YoY usage examples\n- [ ] Manually tested YoY with MCP Inspector (all 6 tools)\n- [ ] No regressions in non-YoY mode","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T12:52:54.125705+01:00","updated_at":"2025-12-18T12:59:11.512861+01:00"}
{"id":"pinmeto-location-mcp-d3p","title":"Fix type duplication between helpers.ts and schemas/output.ts","description":"The MetricData and InsightsData interfaces are defined in both files, creating two sources of truth that could drift apart during maintenance.\n\n**Location:** \n- src/helpers.ts:10-18 (local interfaces)\n- src/schemas/output.ts:11-24 (exported from Zod schemas)\n\n**Current state:**\n```typescript\n// helpers.ts (local interfaces)\ninterface MetricData { key: string; value: number; }\ninterface InsightsData { key: string; metrics: MetricData[]; }\n\n// schemas/output.ts (exported from Zod schemas)\nexport type MetricData = z.infer\u003ctypeof MetricDataSchema\u003e;\nexport type InsightsData = z.infer\u003ctypeof InsightsDataSchema\u003e;\n```\n\n**Fix:** Replace local interfaces in helpers.ts with imports:\n```typescript\nimport { MetricData, InsightsData } from './schemas/output';\n```\n\n**Risk:** Low - simple refactor, types are functionally identical.\n\nPR Review Reference: type-design-analyzer agent identified this as type duplication concern.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-18T17:11:09.616881+01:00","updated_at":"2025-12-19T08:53:58.93746+01:00"}
{"id":"pinmeto-location-mcp-d77","title":"Add test for API failure error handling in search_locations","description":"Add test verifying error response when makePaginatedPinMeToRequest fails (network error, auth error, timeout). Currently no test covers the error path at lines 178-188.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T20:57:08.901235+01:00","updated_at":"2025-12-18T21:01:13.620052+01:00","closed_at":"2025-12-18T21:01:13.620052+01:00","close_reason":"Added test 'should return error response when API request fails' verifying error response when network fails","dependencies":[{"issue_id":"pinmeto-location-mcp-d77","depends_on_id":"pinmeto-location-mcp-b6n","type":"blocks","created_at":"2025-12-18T20:57:16.056368+01:00","created_by":"daemon"}]}
{"id":"pinmeto-location-mcp-h7q","title":"Add progress reporting for long operations","description":"No feedback during long-running paginated requests (5000 locations = 10-30 seconds). Add progress notifications in makePaginatedPinMeToRequest. File: src/mcp_server.ts","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-18T11:36:09.807945+01:00","updated_at":"2025-12-18T11:36:09.807945+01:00"}
{"id":"pinmeto-location-mcp-hmz","title":"Update user documentation (README) when completing tasks that change user-facing behavior","description":"Before marking any task as complete, check if user-facing behavior changed and update README.md accordingly. This includes:\n- New tools or tool parameters\n- Changed tool behavior or output format\n- New configuration options\n- Changed environment variables\n- New features or workflows\n\nThis is a standing reminder - not a one-time task. Reference this issue in PRs that require doc updates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T21:33:21.910208+01:00","updated_at":"2025-12-18T23:12:07.56579+01:00","closed_at":"2025-12-18T23:12:07.56579+01:00","close_reason":"Standing reminder applied - README updated with version badges, one-click install links for VS Code/Cursor, and complete tools list in PR #21"}
{"id":"pinmeto-location-mcp-ikt","title":"Create get_combined_location_insights_yoy tool","description":"Create new combined YoY tool that fetches insights from multiple networks (Google, Facebook, Apple) and returns unified YoY comparison. Reduces multi-network YoY workflow from 6 calls to 1 call (83% reduction). Takes current/previous year date ranges, networks array, and aggregation. Returns per-network and total comparison with change %, trends. Files: src/tools/networks/combined.ts (new), src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] get_combined_location_insights_yoy tool created\n- [ ] Tool registered in src/mcp_server.ts\n- [ ] Input schema with date ranges and networks parameter\n- [ ] Output schema defined (comparison structure)\n- [ ] Fetches from all networks in parallel (Promise.all)\n- [ ] Calculates YoY changes (absolute, percent, trend)\n- [ ] Returns per-network and total summaries\n- [ ] Tool annotations added (readOnlyHint: true)\n- [ ] Tests added for combined YoY logic\n- [ ] Tests cover edge cases (missing data, network failures)\n- [ ] Tool description clear with usage example\n- [ ] CLAUDE.md updated with YoY workflow examples\n- [ ] Manually tested with MCP Inspector\n- [ ] No regressions in existing tools","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T12:52:54.394399+01:00","updated_at":"2025-12-18T12:59:11.254358+01:00"}
{"id":"pinmeto-location-mcp-jcf","title":"Add test for null/missing address handling in search_locations","description":"Add test verifying behavior when location.address is null or address fields are null. Currently no test covers the addressSummary fallback to 'No address'.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T20:57:09.181136+01:00","updated_at":"2025-12-18T21:01:43.404302+01:00","closed_at":"2025-12-18T21:01:43.404302+01:00","close_reason":"Added test 'should handle locations with null or missing address fields gracefully' covering null address, partial address, and complete address scenarios"}
{"id":"pinmeto-location-mcp-jry","title":"Add consistent error field to success responses","description":"Error responses include error field but success responses don't. Makes it harder for AI clients to reliably detect errors. Fix: Include error: undefined in success responses or document the pattern. File: src/tools/locations/locations.ts:197-211","status":"closed","priority":2,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:29:00.413753+01:00","updated_at":"2025-12-18T22:31:55.394323+01:00","closed_at":"2025-12-18T22:31:55.394323+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-m3g","title":"Surface partial pagination failures to users","description":"When pagination fails mid-stream, users get incomplete data without warning. The allPagesFetched flag is lost in response. Fix: Add warning/incomplete field to structuredContent when allPagesFetched === false. File: src/tools/locations/locations.ts:144-157, 197-211","status":"closed","priority":0,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.563815+01:00","updated_at":"2025-12-18T22:31:55.393061+01:00","closed_at":"2025-12-18T22:31:55.393061+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-mzr","title":"Improve output schemas for Ratings and Keywords (replace z.unknown())","description":"RatingsOutputSchema and KeywordsOutputSchema (src/schemas/output.ts:44-56) use z.unknown() for their data fields, providing no structural information to AI clients.\n\n**Current state:**\n```typescript\nexport const RatingsOutputSchema = {\n  data: z.unknown().describe('Ratings data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n\nexport const KeywordsOutputSchema = {\n  data: z.unknown().describe('Keywords data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n```\n\n**Type Design Analysis Ratings:**\n- Encapsulation: 3/10\n- Invariant Expression: 2/10\n- Usefulness: 3/10\n- Enforcement: 1/10\n\n**Recommendation:** Define at least partial schemas with known fields and .passthrough():\n```typescript\nexport const RatingsOutputSchema = {\n  data: z.object({\n    storeId: z.string().optional(),\n    averageRating: z.number().optional(),\n    totalReviews: z.number().optional(),\n    // ... other known fields\n  }).passthrough().describe('Ratings data from the PinMeTo API'),\n  error: z.string().optional().describe('Error message if the request failed')\n};\n```\n\n**Prerequisite:** Document actual API response shapes for ratings and keywords endpoints.\n\nPR Review Reference: type-design-analyzer agent rated these schemas at 2.25/10 overall.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T17:11:10.174818+01:00","updated_at":"2025-12-18T17:11:10.174818+01:00"}
{"id":"pinmeto-location-mcp-ob7","title":"Improve tool naming consistency","description":"Inconsistent patterns (get_all_google_insights vs get_google_keywords). Standardize to {network}_{scope}_{resource} pattern. Add pinmeto_ service prefix per MCP best practice. Breaking change - needs versioning strategy. Files: src/tools/networks/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] All tools renamed with pinmeto_ prefix\n- [ ] Naming pattern {service}_{network}_{action}_{resource} applied\n- [ ] Version bump documented (breaking change)\n- [ ] Migration guide created for existing users\n- [ ] Tests updated with new tool names\n- [ ] All tool registrations updated in src/mcp_server.ts\n- [ ] Tool descriptions reference new names\n- [ ] CLAUDE.md updated with naming conventions\n- [ ] README updated with versioning info\n- [ ] Manually tested all renamed tools with MCP Inspector\n- [ ] No functionality regressions","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:09.479805+01:00","updated_at":"2025-12-18T12:58:32.657358+01:00"}
{"id":"pinmeto-location-mcp-rdr","title":"Fix hardcoded PACKAGE_VERSION in mcp_server.ts","description":"Currently PACKAGE_VERSION is hardcoded in src/mcp_server.ts:33 and must be manually updated on each release. This creates risk of version drift where the code reports a different version than package.json. Need to replace hardcoded constant with dynamic import from package.json to make it the single source of truth. Must be completed before next release to ensure version consistency.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T13:28:44.779145+01:00","updated_at":"2025-12-18T13:28:51.817186+01:00"}
{"id":"pinmeto-location-mcp-sde","title":"Fix cache storing failed fetches as valid data","description":"LocationCache unconditionally caches fetchFn results including failures. If API fails during refresh, users get empty results for 5 minutes with no error. Fix: Only cache successful fetches or keep stale data on failure. File: src/cache/location-cache.ts:44-46","status":"closed","priority":0,"issue_type":"bug","assignee":"Marcus Olsson","created_at":"2025-12-18T22:28:59.286233+01:00","updated_at":"2025-12-18T22:31:55.391909+01:00","closed_at":"2025-12-18T22:31:55.391909+01:00","close_reason":"Closed"}
{"id":"pinmeto-location-mcp-suo","title":"Add non-negative constraint to totalMatches in SearchResultOutputSchema","description":"Change z.number() to z.number().nonnegative() for totalMatches field in src/schemas/output.ts to enforce the invariant that match counts cannot be negative.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-18T20:57:09.471319+01:00","updated_at":"2025-12-18T21:02:10.890179+01:00","closed_at":"2025-12-18T21:02:10.890179+01:00","close_reason":"Added .nonnegative() constraint to totalMatches in SearchResultOutputSchema"}
{"id":"pinmeto-location-mcp-vri","title":"Improve error messages with actionable guidance","description":"Error messages are generic ('Unable to fetch insights data'). Improve with actionable guidance, error codes, and specific next steps. MCP best practice: provide helpful, specific error messages. Files: All tools in src/tools/, src/mcp_server.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Error messages include specific failure reasons\n- [ ] Actionable next steps provided (check auth, retry, etc.)\n- [ ] HTTP status codes included where applicable\n- [ ] Rate limit errors have clear guidance\n- [ ] Authentication errors specify auth method\n- [ ] Network errors distinguish timeout vs connection failure\n- [ ] Tests added for error scenarios\n- [ ] Tests verify error message quality\n- [ ] Tool descriptions mention error handling\n- [ ] CLAUDE.md updated with error handling patterns\n- [ ] Manually tested error scenarios with MCP Inspector\n- [ ] No regressions in successful path functionality","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T11:36:07.592312+01:00","updated_at":"2025-12-18T12:58:33.216033+01:00"}
{"id":"pinmeto-location-mcp-vxb","title":"Add response format flexibility (JSON vs Markdown)","description":"MCP best practice: 'All tools that return data should support multiple formats.' Add response_format parameter (json/markdown) to all tools. JSON for programmatic processing, Markdown for human readability. Files: All tools in src/tools/\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] response_format parameter added to all 13 tools\n- [ ] JSON format returns structured data\n- [ ] Markdown format returns human-readable text with headers/lists\n- [ ] Output schemas support both formats\n- [ ] Default format documented per tool\n- [ ] Tests added for both response formats\n- [ ] Tests verify format switching works correctly\n- [ ] Tool descriptions updated with format examples\n- [ ] CLAUDE.md updated with format selection guidance\n- [ ] Manually tested both formats with MCP Inspector\n- [ ] No regressions in tool functionality","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-18T12:38:24.460065+01:00","updated_at":"2025-12-18T12:58:32.387416+01:00"}
{"id":"pinmeto-location-mcp-zck","title":"Add rate limiting and retry logic","description":"Add rate limiting detection and retry logic with exponential backoff. Handle 429 responses gracefully. Respect API rate limits. Files: src/mcp_server.ts, src/helpers.ts\n\n---\n## Definition of Done\nBefore closing this bead, ensure:\n- [ ] Rate limit detection implemented (429 status code)\n- [ ] Retry logic with exponential backoff added\n- [ ] Configurable retry attempts and delays\n- [ ] Retry-After header respected if present\n- [ ] Rate limit errors have actionable messages\n- [ ] Circuit breaker pattern considered\n- [ ] Tests added for rate limiting scenarios\n- [ ] Tests verify retry logic with mocked 429 responses\n- [ ] CLAUDE.md updated with rate limiting behavior\n- [ ] Manually tested rate limit handling\n- [ ] Tool descriptions mention retry behavior\n- [ ] No infinite retry loops","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-18T11:36:07.886561+01:00","updated_at":"2025-12-18T13:02:22.520299+01:00"}
